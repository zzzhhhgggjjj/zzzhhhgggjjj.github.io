<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/wenzhang/#%20%E6%95%B0%E4%BB%93%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86%E5%B9%B3%E5%8F%B0%E4%BB%8B%E7%BB%8D/"/>
      <url>/wenzhang/#%20%E6%95%B0%E4%BB%93%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86%E5%B9%B3%E5%8F%B0%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="数仓数据治理平台介绍"><a href="#数仓数据治理平台介绍" class="headerlink" title="数仓数据治理平台介绍"></a>数仓数据治理平台介绍</h1><p>点击此链接可访问本项目：<a href="https://edu.094512.xyz/#/dashboard">数据治理考评平台</a>(此链接仅供展示，里面数据不全，某些功能也因为服务器配置原因未实现)</p><h3 id="一、元数据模块"><a href="#一、元数据模块" class="headerlink" title="一、元数据模块"></a>一、元数据模块</h3><h4 id="1、点击元数据管理选项"><a href="#1、点击元数据管理选项" class="headerlink" title="1、点击元数据管理选项"></a>1、点击元数据管理选项</h4><p><img src="https://img02.094250.xyz/img/Snipaste_dm.webp" alt="img"></p><h4 id="2、输入表名，输入库名，选择层级，点击查询可以看到各表的基本信息，点击清空会清除查询条件，表名和库名支持模糊匹配"><a href="#2、输入表名，输入库名，选择层级，点击查询可以看到各表的基本信息，点击清空会清除查询条件，表名和库名支持模糊匹配" class="headerlink" title="2、输入表名，输入库名，选择层级，点击查询可以看到各表的基本信息，点击清空会清除查询条件，表名和库名支持模糊匹配"></a>2、输入表名，输入库名，选择层级，点击查询可以看到各表的基本信息，点击清空会清除查询条件，<code>表名和库名支持模糊匹配</code></h4><p><img src="https://img02.094250.xyz/img/Snipaste_ddm3.png" alt="img"></p><h4 id="3、点击手动更新元数据库数据，填入时间和库名会跟新各表的元数据但一般不会手动更新，因为元数据更新耗时也挺久，所有会在前一天数仓数据更新完以后自动更新，如果元数据更新出错可以手动更新，否则不建议手动更新-重复更新不会数据重复，会先删除再更新，sql注入问题也处理过"><a href="#3、点击手动更新元数据库数据，填入时间和库名会跟新各表的元数据但一般不会手动更新，因为元数据更新耗时也挺久，所有会在前一天数仓数据更新完以后自动更新，如果元数据更新出错可以手动更新，否则不建议手动更新-重复更新不会数据重复，会先删除再更新，sql注入问题也处理过" class="headerlink" title="3、点击手动更新元数据库数据，填入时间和库名会跟新各表的元数据但一般不会手动更新，因为元数据更新耗时也挺久，所有会在前一天数仓数据更新完以后自动更新，如果元数据更新出错可以手动更新，否则不建议手动更新(重复更新不会数据重复，会先删除再更新，sql注入问题也处理过)"></a>3、点击手动更新元数据库数据，填入时间和库名会跟新各表的元数据<code>但一般不会手动更新，因为元数据更新耗时也挺久，所有会在前一天数仓数据更新完以后自动更新，如果元数据更新出错可以手动更新，否则不建议手动更新</code>(重复更新不会数据重复，会先删除再更新，sql注入问题也处理过)</h4><p><img src="https://img02.094250.xyz/img/Snipaste_ddm.webp" alt="img"></p><h4 id="4、点击表名可以查看元数据详细信息"><a href="#4、点击表名可以查看元数据详细信息" class="headerlink" title="4、点击表名可以查看元数据详细信息"></a>4、点击表名可以查看元数据详细信息</h4><p><img src="https://img02.094250.xyz/img/Snipaste_dm1.webp" alt="img"></p><h4 id="5、可对附加信息进行更改"><a href="#5、可对附加信息进行更改" class="headerlink" title="5、可对附加信息进行更改"></a>5、可对附加信息进行更改</h4><p><img src="https://img02.094250.xyz/img/Snipaste_dm2.png" alt="img"></p><h3 id="二、-考评模块"><a href="#二、-考评模块" class="headerlink" title="二、 考评模块"></a>二、 考评模块</h3><h4 id="1、点击数据治理考评查看数仓各表，各人问题，排名和分数"><a href="#1、点击数据治理考评查看数仓各表，各人问题，排名和分数" class="headerlink" title="1、点击数据治理考评查看数仓各表，各人问题，排名和分数"></a>1、点击数据治理考评查看数仓各表，各人问题，排名和分数</h4><p><img src="https://img02.094250.xyz/img/Snipaste_dga.webp" alt="img"></p><h4 id="2、点击重新评估选择评估日期可以重新评估当日的数仓各表，各人问题，排名和分数当然也不建议手动评定，每日的评估会在后台定时调度，手动评估可以在评估出错的情况或人员对其表所展现出的错误进行改动后重新评估"><a href="#2、点击重新评估选择评估日期可以重新评估当日的数仓各表，各人问题，排名和分数当然也不建议手动评定，每日的评估会在后台定时调度，手动评估可以在评估出错的情况或人员对其表所展现出的错误进行改动后重新评估" class="headerlink" title="2、点击重新评估选择评估日期可以重新评估当日的数仓各表，各人问题，排名和分数当然也不建议手动评定，每日的评估会在后台定时调度，手动评估可以在评估出错的情况或人员对其表所展现出的错误进行改动后重新评估"></a>2、点击重新评估选择评估日期可以重新评估当日的数仓各表，各人问题，排名和分数<code>当然也不建议手动评定，每日的评估会在后台定时调度，手动评估可以在评估出错的情况或人员对其表所展现出的错误进行改动后重新评估</code></h4><p><img src="https://img02.094250.xyz/img/Snipaste_dg.webp" alt="img"></p><h4 id="3、人员对表的辅助信息进行改动"><a href="#3、人员对表的辅助信息进行改动" class="headerlink" title="3、人员对表的辅助信息进行改动"></a>3、人员对表的辅助信息进行改动</h4><p><img src="https://img02.094250.xyz/img/Snipaste_dg2.webp" alt="img"></p><h3 id="三、文章结尾"><a href="#三、文章结尾" class="headerlink" title="三、文章结尾"></a>三、文章结尾</h3><h4 id="1、该项目具体技术看这"><a href="#1、该项目具体技术看这" class="headerlink" title="1、该项目具体技术看这"></a>1、该项目具体技术看这</h4><h4 id="2、该项目免费部署看这"><a href="#2、该项目免费部署看这" class="headerlink" title="2、该项目免费部署看这"></a>2、该项目免费部署看这</h4>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>数据治理项目介绍</title>
      <link href="/wenzhang/%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/"/>
      <url>/wenzhang/%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 数据治理项目介绍<p>date: 1741431807000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>flink</title>
      <link href="/wenzhang/flink/"/>
      <url>/wenzhang/flink/</url>
      
        <content type="html"><![CDATA[<p>provide标签：表示只参与编译，不参与运行</p><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: flink<p>date: 1741087194000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linuxone服务器免费使用</title>
      <link href="/wenzhang/linuxone%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%8D%E8%B4%B9%E4%BD%BF%E7%94%A8/"/>
      <url>/wenzhang/linuxone%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%8D%E8%B4%B9%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p><a href="https://linuxone.cloud.marist.edu/">https://linuxone.cloud.marist.edu/</a><br>注册账号，登录后即可免费使用linuxone服务器(2个月，4G内存，50G硬盘空间，2核，<code>s390x架构</code>)。</p><p>创建实例，保存ssh key,远程连接要用这个key，它不会给任何用户的密码，默认用linux1用户登录。</p><p>安装 MySQL 8.x(如果要安装mysql8，需要自己编译安装，比较麻烦，可以用docker安装mysql8)</p><p>安装 Docker<br>这是安装docker的文档：<br><a href="https://docs.docker.com/engine/install/rhel/">https://docs.docker.com/engine/install/rhel/</a></p><p>每次使用docker的时候都需要使用root用户, 比较麻烦.   可用把普通用户添加到docker组, 避免每次都添加sudo.<br> sudo usermod -aG docker linux1</p><pre><code>退出当前shell, 重新进入shell, 使刚才的配置生效</code></pre><p>docker 安装 mysql8<br><code>docker pull ibmcom/mysql-s390x:8.0.25</code></p><p><a href="https://hub.docker.com/u/s390x">https://hub.docker.com/u/s390x</a></p><p>docker run –name mysql-s390x –restart always -v &#x2F;path&#x2F;to&#x2F;host&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;000000 -d ibmcom&#x2F;mysql-s390x:8.0.25</p><p>docker exec -it mysql-s390x mysql -uroot -p000000</p><p>注意：如果您想使用像firewalld这样的防火墙管理工具，您需要删除保存的iptables文件。</p><p>防火墙通过 iptables 规则启用。默认情况下，只有 SSH 端口是开放的。如果您需要打开其他端口，请使用 iptables 修改防火墙规则<br>sudo iptables -I INPUT -p tcp –dport &lt;port#&gt; -j ACCEPT </p><p>如果要永久保留更改，请发出以下命令：<br>sudo bash -c “iptables-save &gt; &#x2F;etc&#x2F;sysconfig&#x2F;iptables.save”</p><p>docker exec -it mysql-s390x bash<br>vim &#x2F;etc&#x2F;mysql&#x2F;mysql.conf.d&#x2F;mysqld.cnf</p><p>apt-get update</p><p>apt-get install -y vim</p><p>只需确保 bind-address 设置为 0.0.0.0，这样其他机器就可以通过 MySQL 的标准协议（3306端口）进行连接。</p><p>docker restart mysql-s390x</p><p>确保mysql容器因为某种原因停止运行，可以重启容器：<br>docker update –restart always mysql-s390x</p><p>在 RHEL 8 中，yum 已被 dnf（Dandified Yum）替代，dnf 是新版的包管理工具，提供了与 yum 类似的功能，但性能更好，处理依赖关系更高效。</p><p>sudo dnf update -y<br>sudo dnf install java-17-openjdk -y</p><p>sudo dnf install vim -y</p><p>为了方便你在终端或脚本中使用 Java，可以设置 JAVA_HOME 环境变量。编辑 &#x2F;etc&#x2F;profile 或用户的 ~&#x2F;.bashrc 文件，并添加以下行：<br>export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-17-openjdk<br>export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH</p><p>然后使其生效：<br>source ~&#x2F;.bashrc<br>接下来，使用 dnf 包管理工具来安装 Node.js 16：<br>sudo dnf install -y nodejs</p><p>4.4 创建数据库<br>CREATE DATABASE <code>dga</code> &#x2F;*!40100 DEFAULT CHARACTER SET utf8mb3 COLLATE utf8mb4_0900_ai_ci *&#x2F; </p><p>建表<br>元数据信息表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span>  table_meta_info</span><br><span class="line">(</span><br><span class="line">    id                      <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;表id&#x27;</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    table_name              <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">    schema_name             <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;库名&#x27;</span>,</span><br><span class="line">    col_name_json           <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">null</span> comment <span class="string">&#x27;字段名json ( 来源:hive)&#x27;</span>,</span><br><span class="line">    partition_col_name_json <span class="type">varchar</span>(<span class="number">4000</span>) <span class="keyword">null</span> comment <span class="string">&#x27;分区字段名json( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_fs_owner          <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;hdfs所属人 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_parameters_json   <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">null</span> comment <span class="string">&#x27;参数信息 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_comment           <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;表备注 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_fs_path           <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;hdfs路径 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_input_format      <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;输入格式( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_output_format     <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;输出格式 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_row_format_serde  <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;行格式 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_create_time       <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;表创建时间 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_type              <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;表类型 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_bucket_cols_json  <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;分桶列 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_bucket_num        <span class="type">bigint</span>        <span class="keyword">null</span> comment <span class="string">&#x27;分桶个数 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_sort_cols_json    <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;排序列 ( 来源:hive)&#x27;</span>,</span><br><span class="line">    table_size              <span class="type">bigint</span>        <span class="keyword">null</span> comment <span class="string">&#x27;数据量大小 ( 来源:hdfs)&#x27;</span>,</span><br><span class="line">    table_total_size        <span class="type">bigint</span>        <span class="keyword">null</span> comment <span class="string">&#x27;所有副本数据总量大小  ( 来源:hdfs)&#x27;</span>,</span><br><span class="line">    table_last_modify_time  datetime      <span class="keyword">null</span> comment <span class="string">&#x27;最后修改时间   ( 来源:hdfs)&#x27;</span>,</span><br><span class="line">    table_last_access_time  datetime      <span class="keyword">null</span> comment <span class="string">&#x27;最后访问时间   ( 来源:hdfs)&#x27;</span>,</span><br><span class="line">    fs_capcity_size         <span class="type">bigint</span>        <span class="keyword">null</span> comment <span class="string">&#x27;当前文件系统容量   ( 来源:hdfs)&#x27;</span>,</span><br><span class="line">    fs_used_size            <span class="type">bigint</span>        <span class="keyword">null</span> comment <span class="string">&#x27;当前文件系统使用量   ( 来源:hdfs)&#x27;</span>,</span><br><span class="line">    fs_remain_size          <span class="type">bigint</span>        <span class="keyword">null</span> comment <span class="string">&#x27;当前文件系统剩余量   ( 来源:hdfs)&#x27;</span>,</span><br><span class="line">    assess_date             <span class="type">varchar</span>(<span class="number">10</span>)   <span class="keyword">null</span> comment <span class="string">&#x27;考评日期 &#x27;</span>,</span><br><span class="line">    create_time             datetime      <span class="keyword">null</span> comment <span class="string">&#x27;创建时间 (自动生成)&#x27;</span>,</span><br><span class="line">    update_time             datetime      <span class="keyword">null</span> comment <span class="string">&#x27;更新时间  (自动生成)&#x27;</span>,</span><br><span class="line">    <span class="keyword">constraint</span> table_meta_info_pk</span><br><span class="line">        <span class="keyword">unique</span> (table_name, schema_name, assess_date)</span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;元数据表&#x27;</span>;</span><br></pre></td></tr></table></figure><p>元数据表附加信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> table_meta_info_extra</span><br><span class="line">(</span><br><span class="line">    id                   <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;表id&#x27;</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    table_name           <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">null</span> comment <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">    schema_name          <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">null</span> comment <span class="string">&#x27;库名&#x27;</span>,</span><br><span class="line">    tec_owner_user_name  <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;技术负责人   &#x27;</span>,</span><br><span class="line">    busi_owner_user_name <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;业务负责人 &#x27;</span>,</span><br><span class="line">    lifecycle_type       <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;存储周期类型(FOREVER、NORMAL、UNSET)&#x27;</span>,</span><br><span class="line">    lifecycle_days       <span class="type">bigint</span>       <span class="keyword">null</span> comment <span class="string">&#x27;生命周期(天) &#x27;</span>,</span><br><span class="line">    security_level       <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;安全级别 (UNSET、PUBLIC、INSIDE、INSIDE_LIMIT、PROTECT)&#x27;</span>,</span><br><span class="line">    dw_level             <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;数仓所在层级(ODSDWDDIMDWSADS) ( 来源: 附加)&#x27;</span>,</span><br><span class="line">    create_time          datetime     <span class="keyword">null</span> comment <span class="string">&#x27;创建时间 (自动生成)&#x27;</span>,</span><br><span class="line">    update_time          datetime     <span class="keyword">null</span> comment <span class="string">&#x27;更新时间  (自动生成)&#x27;</span>,</span><br><span class="line">    <span class="keyword">constraint</span> table_meta_info_extra_pk</span><br><span class="line">        <span class="keyword">unique</span> (table_name, schema_name)</span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;元数据表附加信息&#x27;</span>;</span><br></pre></td></tr></table></figure><p>考评指标参数表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> governance_metric</span><br><span class="line">(</span><br><span class="line">    id                 <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;id&#x27;</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    metric_name        <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;指标名称&#x27;</span>,</span><br><span class="line">    metric_code        <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;指标编码&#x27;</span>,</span><br><span class="line">    metric_desc        <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">null</span> comment <span class="string">&#x27;指标描述&#x27;</span>,</span><br><span class="line">    governance_type    <span class="type">varchar</span>(<span class="number">20</span>)   <span class="keyword">null</span> comment <span class="string">&#x27;治理类型&#x27;</span>,</span><br><span class="line">    metric_params_json <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">null</span> comment <span class="string">&#x27;指标参数&#x27;</span>,</span><br><span class="line">    governance_url     <span class="type">varchar</span>(<span class="number">500</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;治理连接&#x27;</span>,</span><br><span class="line">    is_disabled        <span class="type">varchar</span>(<span class="number">1</span>)    <span class="keyword">null</span> comment <span class="string">&#x27;是否启用&#x27;</span></span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;考评指标参数表&#x27;</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th>板块</th><th>权重</th></tr></thead><tbody><tr><td>规范</td><td>15</td></tr><tr><td>存储</td><td>30</td></tr><tr><td>计算</td><td>30</td></tr><tr><td>质量</td><td>15</td></tr><tr><td>安全</td><td>10</td></tr></tbody></table><p>考评指标权重表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `governance_type` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `type_code` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;治理项类型编码&#x27;</span>,</span><br><span class="line">  `type_desc` <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;治理项类型描述&#x27;</span>,</span><br><span class="line">  `type_weight` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;治理类型权重&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">6</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 COMMENT<span class="operator">=</span><span class="string">&#x27;治理考评类别权重表&#x27;</span>;</span><br></pre></td></tr></table></figure><p>插入指标</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> governance_type (id, type_code, type_desc, type_weight) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;SPEC&#x27;</span>, <span class="string">&#x27;规范&#x27;</span>, <span class="number">20.00</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;STORAGE&#x27;</span>, <span class="string">&#x27;存储&#x27;</span>, <span class="number">30.00</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;CALC&#x27;</span>, <span class="string">&#x27;计算&#x27;</span>, <span class="number">30.00</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;QUALITY&#x27;</span>, <span class="string">&#x27;质量&#x27;</span>, <span class="number">15.00</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;SECURITY&#x27;</span>, <span class="string">&#x27;安全&#x27;</span>, <span class="number">15.00</span>);</span><br></pre></td></tr></table></figure><p>考评指标明细表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `governance_assess_detail` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `assess_date` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;考评日期&#x27;</span>,</span><br><span class="line">  `table_name` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">  `schema_name` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;库名&#x27;</span>,</span><br><span class="line">  `metric_id` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;指标项id&#x27;</span>,</span><br><span class="line">  `metric_name` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;指标项名称&#x27;</span>,</span><br><span class="line">  `governance_type` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;治理类型&#x27;</span>,</span><br><span class="line">  `tec_owner` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;技术负责人&#x27;</span>,</span><br><span class="line">  `assess_score` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;考评得分&#x27;</span>,</span><br><span class="line">  `assess_problem` <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;考评问题项&#x27;</span>,</span><br><span class="line">  `assess_comment` <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;考评备注&#x27;</span>,</span><br><span class="line">  `is_assess_exception` <span class="type">varchar</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;考评是否异常&#x27;</span>,</span><br><span class="line">  `assess_exception_msg` <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;异常信息&#x27;</span>,</span><br><span class="line">  `governance_url` <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;治理处理路径&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建日期&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB   <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 COMMENT<span class="operator">=</span><span class="string">&#x27;治理考评结果明细&#x27;</span>;</span><br></pre></td></tr></table></figure><p>插入指标</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> `governance_metric` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;是否有技术Owner&#x27;</span>,<span class="string">&#x27;TEC_OWNER&#x27;</span>,<span class="string">&#x27;辅助信息是否填写技术Owner 有 则10分 ， 无则0分&#x27;</span>,<span class="string">&#x27;SPEC&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;是否有业务Owner&#x27;</span>,<span class="string">&#x27;BUSI_OWNER&#x27;</span>,<span class="string">&#x27;辅助信息是否填写业务Owner 有 则10分 ， 无则0分&#x27;</span>,<span class="string">&#x27;SPEC&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;表名合规&#x27;</span>,<span class="string">&#x27;TABLE_NAME_STANDARD&#x27;</span>,<span class="string">&#x27;参考建数仓表规范\nODS层 ：开头:ods  结尾 :inc/full  \n结构ods_xx_( inc|full)\nDIM层 :  dim开头     full/zip 结尾 \n结构: ods_xx_( inc|full)\nDWD层:  dwd 开头  inc/full 结尾  \n结构： dwd_xx_xx_(inc|full)\nDWS层： dws开头  \n结构dws_xx_xx_xx_ (1d/nd/td) \nADS层： ads 开头\n结构 ads_xxx\n符合则 10分，否则0分\n&#x27;</span>,<span class="string">&#x27;SPEC&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">4</span>,<span class="string">&#x27;是否纳入分层&#x27;</span>,<span class="string">&#x27;TABLE_DW_LEVEL&#x27;</span>,<span class="string">&#x27;设定分层则10分，OTHER则0分&#x27;</span>,<span class="string">&#x27;SPEC&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">5</span>,<span class="string">&#x27;表有备注&#x27;</span>,<span class="string">&#x27;TABLE_COMMENT&#x27;</span>,<span class="string">&#x27;有 则10分 ， 无则0分&#x27;</span>,<span class="string">&#x27;SPEC&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">6</span>,<span class="string">&#x27;字段有备注信息&#x27;</span>,<span class="string">&#x27;FIELD_COMMENT&#x27;</span>,<span class="string">&#x27;有备注字段/所有字段 *10分&#x27;</span>,<span class="string">&#x27;SPEC&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">7</span>,<span class="string">&#x27;生命周期合理&#x27;</span>,<span class="string">&#x27;LIFECYCLE&#x27;</span>,<span class="string">&#x27;未设定周期类型的 给 0分\n周期类型为永久 则给10分\n周期类型为普通 :\n无分区信息的给0分\n            没设生命周期给0分\n周期长度超过建议周期天数&#123;days&#125;给50分\n&#x27;</span>,<span class="string">&#x27;STORAGE&#x27;</span>,<span class="string">&#x27;&#123;\&quot;days\&quot;:60&#125;&#x27;</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">8</span>,<span class="string">&#x27;是否空表&#x27;</span>,<span class="string">&#x27;TABLE_EMPTY&#x27;</span>,<span class="string">&#x27;空表则0分 ，有数据则10分&#x27;</span>,<span class="string">&#x27;STORAGE&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">9</span>,<span class="string">&#x27;存在相似表&#x27;</span>,<span class="string">&#x27;TABLE_SIMILAR&#x27;</span>,<span class="string">&#x27;两个表字段重复超过&#123;percent&#125;%，则给0分，其余给10分&#x27;</span>,<span class="string">&#x27;STORAGE&#x27;</span>,<span class="string">&#x27;&#123;\&quot;percent\&quot;:70&#125;&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">10</span>,<span class="string">&#x27;长期无产出&#x27;</span>,<span class="string">&#x27;NO_PRODUCE&#x27;</span>,<span class="string">&#x27;一张表&#123;days&#125;天内没有产出数据  则给0分，其余给10&#x27;</span>,<span class="string">&#x27;CALC&#x27;</span>,<span class="string">&#x27;&#123;\&quot;days\&quot;:7&#125;&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">11</span>,<span class="string">&#x27;长期无访问&#x27;</span>,<span class="string">&#x27;NO_ACCESS&#x27;</span>,<span class="string">&#x27;一张表&#123;days&#125;天内没有访问 则给0分 ， 其余给10&#x27;</span>,<span class="string">&#x27;CALC&#x27;</span>,<span class="string">&#x27;&#123;\&quot;days\&quot;:7&#125;&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">12</span>,<span class="string">&#x27;计算中有报错&#x27;</span>,<span class="string">&#x27;TASK_FAILED&#x27;</span>,<span class="string">&#x27;检查DS 有报错 则给0分，其余给10分&#x27;</span>,<span class="string">&#x27;CALC&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">13</span>,<span class="string">&#x27;简单加工&#x27;</span>,<span class="string">&#x27;SIMPLE_PROCESS&#x27;</span>,<span class="string">&#x27;sql语句没有任何join\\groupby\\ 非分区字段的where过滤   ，以上情况给0分，其余给10分任务信息&#x27;</span>,<span class="string">&#x27;CALC&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">14</span>,<span class="string">&#x27;表产出时效监控&#x27;</span>,<span class="string">&#x27;TIME_LINESS&#x27;</span>,<span class="string">&#x27;前一天产出时效，超过前&#123;days&#125;天产出时效平均值&#123;percent&#125;%\n则给0分，其余10分\n&#x27;</span>,<span class="string">&#x27;QUALITY&#x27;</span>,<span class="string">&#x27;&#123;\&quot;days\&quot;:7,\&quot;percent\&quot;:70&#125;&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">15</span>,<span class="string">&#x27;表产出数据量监控&#x27;</span>,<span class="string">&#x27;PRODUCE_DATA_SIZE&#x27;</span>,<span class="string">&#x27;必须日分区表\n前一天产出的数据量，超过前&#123;days&#125;天平均产出量&#123;upper_limit&#125;% ，或低于&#123;lower_limit&#125;%  ，则给0分，其余10分\n&#x27;</span>,<span class="string">&#x27;QUALITY&#x27;</span>,<span class="string">&#x27;&#123;\&quot;days\&quot;:7,\&quot;&#123;upper_limit&#125;\&quot;:70,\&quot;&#123;lower_limit&#125;\&quot;:50&#125;&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">16</span>,<span class="string">&#x27;未明确安全等级&#x27;</span>,<span class="string">&#x27;SECURITY_LEVEL&#x27;</span>,<span class="string">&#x27;未设置 0分  其余10分&#x27;</span>,<span class="string">&#x27;SECURITY&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;/table_meta/table_meta/detail?tableId=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="number">17</span>,<span class="string">&#x27;目录文件数据访问权限超过建议值&#x27;</span>,<span class="string">&#x27;FILE_ACCESS_PERMISSION&#x27;</span>,<span class="string">&#x27;检查该表最高权限的目录或者文件，如果超过文件超过&#123;file_permission&#125;或者目录超过&#123;dir_permission&#125;则给0分 其余给10分&#x27;</span>,<span class="string">&#x27;SECURITY&#x27;</span>,<span class="string">&#x27;&#123;\&quot;dir_permission\&quot;:\&quot;755\&quot;,\&quot;file_permission\&quot;:\&quot;644\&quot;&#125;&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>);</span><br></pre></td></tr></table></figure><p>12,13,14至1<br>TABLE_DW_LEVEL<br>PRODUCE_DATA_SIZE</p><p>11.1.1 各表的考评结果表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> governance_assess_table</span><br><span class="line">(</span><br><span class="line">    id                   <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;id&#x27;</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    assess_date          <span class="type">varchar</span>(<span class="number">10</span>)    <span class="keyword">null</span> comment <span class="string">&#x27;考评日期&#x27;</span>,</span><br><span class="line">    table_name           <span class="type">varchar</span>(<span class="number">200</span>)   <span class="keyword">null</span> comment <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">    schema_name          <span class="type">varchar</span>(<span class="number">200</span>)   <span class="keyword">null</span> comment <span class="string">&#x27;库名&#x27;</span>,</span><br><span class="line">    tec_owner            <span class="type">varchar</span>(<span class="number">200</span>)   <span class="keyword">null</span> comment <span class="string">&#x27;技术负责人&#x27;</span>,</span><br><span class="line">    score_spec_avg       <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;规范分数&#x27;</span>,</span><br><span class="line">    score_storage_avg    <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;存储分数&#x27;</span>,</span><br><span class="line">    score_calc_avg       <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;计算分数&#x27;</span>,</span><br><span class="line">    score_quality_avg    <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;质量分数&#x27;</span>,</span><br><span class="line">    score_security_avg   <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;安全分数&#x27;</span>,</span><br><span class="line">    score_on_type_weight <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;五维权重后分数&#x27;</span>,</span><br><span class="line">    problem_num          <span class="type">bigint</span>         <span class="keyword">null</span> comment <span class="string">&#x27;问题项个数&#x27;</span>,</span><br><span class="line">    create_time          datetime       <span class="keyword">null</span> comment <span class="string">&#x27;创建日期&#x27;</span></span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;表治理考评情况&#x27;</span>;</span><br></pre></td></tr></table></figure><p>11.2.1 各个技术负责人的考评结果表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> governance_assess_tec_owner</span><br><span class="line">(</span><br><span class="line">    id             <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;id&#x27;</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    assess_date    <span class="type">varchar</span>(<span class="number">10</span>)    <span class="keyword">null</span> comment <span class="string">&#x27;考评日期&#x27;</span>,</span><br><span class="line">    tec_owner      <span class="type">varchar</span>(<span class="number">200</span>)   <span class="keyword">null</span> comment <span class="string">&#x27;技术负责人&#x27;</span>,</span><br><span class="line">    score_spec     <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;规范分数&#x27;</span>,</span><br><span class="line">    score_storage  <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;存储分数&#x27;</span>,</span><br><span class="line">    score_calc     <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;计算分数&#x27;</span>,</span><br><span class="line">    score_quality  <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;质量分数&#x27;</span>,</span><br><span class="line">    score_security <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;安全分数&#x27;</span>,</span><br><span class="line">    score          <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;分数&#x27;</span>,</span><br><span class="line">    table_num      <span class="type">bigint</span>         <span class="keyword">null</span> comment <span class="string">&#x27;涉及表&#x27;</span>,</span><br><span class="line">    problem_num    <span class="type">bigint</span>         <span class="keyword">null</span> comment <span class="string">&#x27;问题项个数&#x27;</span>,</span><br><span class="line">    create_time    datetime       <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;技术负责人治理考评表&#x27;</span>;</span><br></pre></td></tr></table></figure><p>11.3.1 各个全局的考评结果表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> governance_assess_global</span><br><span class="line">(</span><br><span class="line">    id             <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;id&#x27;</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    assess_date    <span class="type">varchar</span>(<span class="number">10</span>)    <span class="keyword">null</span> comment <span class="string">&#x27;考评日期&#x27;</span>,</span><br><span class="line">    score_spec     <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;规范分数&#x27;</span>,</span><br><span class="line">    score_storage  <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;存储分数&#x27;</span>,</span><br><span class="line">    score_calc     <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;计算分数&#x27;</span>,</span><br><span class="line">    score_quality  <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;质量分数&#x27;</span>,</span><br><span class="line">    score_security <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;安全分数&#x27;</span>,</span><br><span class="line">    score          <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">null</span> comment <span class="string">&#x27;分数&#x27;</span>,</span><br><span class="line">    table_num      <span class="type">bigint</span>         <span class="keyword">null</span> comment <span class="string">&#x27;涉及表&#x27;</span>,</span><br><span class="line">    problem_num    <span class="type">bigint</span>         <span class="keyword">null</span> comment <span class="string">&#x27;问题项个数&#x27;</span>,</span><br><span class="line">    create_time    datetime       <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;治理总考评表&#x27;</span>;</span><br></pre></td></tr></table></figure><p>sudo dnf install -y make gcc-c++ python3</p><p>sudo dnf install tmux</p><p> 启动一个新的 tmux 会话<br>tmux new -s my_session</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">tmux new-session -d -s mysession</span><br><span class="line"></span><br><span class="line">tmux send-keys -t mysession &quot;java -jar /home/linux1/data/dga_1219-0.0.1-SNAPSHOT.jar&quot; C-m</span><br><span class="line">tmux new-window -t mysession</span><br><span class="line">tmux send-keys -t mysession:1 &quot;java -jar /home/linux1/data/yuntai-backend-1.0-SNAPSHOT.jar&quot; C-m</span><br><span class="line">tmux new-window -t mysession</span><br><span class="line">tmux send-keys -t mysession:2 &quot;cd /home/linux1/data/yuntai-frontend &amp;&amp; npm install &amp;&amp; npm run dev&quot; C-m</span><br></pre></td></tr></table></figure><p>chmod +x start.sh</p><p>进入 tmux 会话<br>tmux attach -t mysession<br>列出所有窗口：Ctrl + B，然后按 W<br>切换到下一个窗口：Ctrl + B，然后按 N<br>切换到上一个窗口：Ctrl + B，然后按 P<br>直接跳转到窗口 0 &#x2F; 1 &#x2F; 2：Ctrl + B，然后按 0 或 1 或<br>如果你想退出 tmux 但保持进程运行：<br>Ctrl + B，然后按 D</p><p>杀死 tmux 会话（停止所有进程）：<br>tmux kill-session -t mysession</p><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: linuxone服务器免费使用<p>date: 1740650155000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>数据中台技术</title>
      <link href="/wenzhang/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E6%8A%80%E6%9C%AF/"/>
      <url>/wenzhang/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E6%8A%80%E6%9C%AF/</url>
      
        <content type="html"><![CDATA[<p>此项目不涉及高并发，所有没有springcloud的相关内容。</p><p>利用Springboot 搭建外部服务。<br> 利用Mybatis及Mybatis-plus操作MySQL数据库。<br>         从Hive中提取需要的元数据。<br>         从 HDFS中提取相关信息。<br>         从DolphinScheduler 的任务信息中提取相关信息。</p><p>3.1.1 什么是Web服务<br>    Web服务（http服务），接收网页或者App应用发起的http请求，然后通过程序进行处理、计算、查询、存储等，再将结果返回给页面或App应用。<br>    <img src="https://img01.zzh36111.us.kg/20250219163710.png" alt="web服务"></p><p>在Springboot框架之前，最流行的框架组合就是所谓的“SSM”,即SpringMVC+Spring+Mybatis</p><p>SSM虽好，但是通过搭建一个SSM项目还是比较繁琐的，需要大量的xml配置文件。<br>springboot整合了springmvc ,spring,mybatis 等核心功能。也就是说本质上实现功能的还是原有的spring ,springmvc的包，但是springboot单独包装了一层，这样用户就不必直接对springmvc， spring等，在xml中配置</p><p>3.2.2 Springboot 的优势</p><p>不再需要那些千篇一律，繁琐的xml文件。<br>内嵌Tomcat,不再需要外部的Tomcat<br>更方便的和各个第三方工具（mysql,redis,elasticsearch,dubbo,kafka等等整合），而只要维护一个配置文件即可。</p><p>创建springboot项目</p><p>选择spring web 包括web应用的常用注解，以及web容器（默认tomcat，如果不勾选，项目没有web服务能力）</p><p>创建好后的，springboot的工程比maven的工程多了两个文件。其中：<br>DemoCustomerApplication  是整个程序的启动类。<br>application.properties 是整个工程的配置文件。</p><p>如果idea报红线 ,但是又觉没问题(以compile编译成功为准)</p><p><img src="https://img01.zzh36111.us.kg/20250219171553.png" alt="请求"><br>请求 method  请求方式<br>get  读    post  写       ( put  写(幂等性写入)  delete  (删除)   不常用)<br>状态码（常见）<br>  1xx      访问中未完成<br>  2xx      已完成   200<br>  3xx       跳转<br>4xx        客户端错误<br>  400   bad request   参数不合格  （ 个数，类型）<br>  403   禁止访问<br>  405<br>  404   not found     未找到资源<br>5xx 服务器错误<br>  500  后台程序抛异常了     去看控制台 报错<br>6xx  及以上  自定义 </p><p><img src="https://img01.zzh36111.us.kg/20250219172913.png" alt="web分层"></p><table><thead><tr><th>分层</th><th>名称</th><th>职责</th><th>涉及的标签</th></tr></thead><tbody><tr><td>controller</td><td>控制层</td><td>1 接收请求和参数。<br>2 调用服务层。<br>3 返回响应和结果。</td><td>⑥RestController。<br>⑦RequestMapping。<br>⑧RequestParam。<br>⑨RequestBody。</td></tr><tr><td>service</td><td>服务层（业务层）</td><td>1 接收控制层调用。<br>2 处理业务。<br>3 返回结果。</td><td>⑩Service。<br>⑪Autowired。</td></tr><tr><td>mapper</td><td>数据层</td><td>1 接收服务层调用。<br>2 数据库的操作（SQL）。<br>3 返回结果。</td><td>⑫Select。<br>⑬Insert。<br>⑭Delete。<br>⑮Update。<br>⑯Param。</td></tr></tbody></table><p>注解说明</p><table><thead><tr><th>注释</th><th>位置</th><th>说明</th></tr></thead><tbody><tr><td>@RestController</td><td>类</td><td>标识入口类。</td></tr><tr><td>@RequestMapping</td><td>方法</td><td>标识入口方法。</td></tr><tr><td>@GetMapping</td><td>方法</td><td>标识入口方法 GET 请求专用。</td></tr><tr><td>@PostMapping</td><td>方法</td><td>标识入口方法 POST 请求专用。</td></tr><tr><td>@RequestParam</td><td>参数</td><td>接收路径上的键值对参数。例如：<code>http://xxxxx/xx?name=xxx&amp;age=xxx</code>。</td></tr><tr><td>@PathVariable</td><td>参数</td><td>接收路径上的值。例如：<code>http://xxxxx/customer/123</code>。</td></tr><tr><td>@RequestBody</td><td>参数</td><td>接收请求体(payload) 中的参数。</td></tr></tbody></table><p>例如：<code>http://xxxxx/xx?name=xxx&amp;age=xxx</code>参数多，可以用实体类接收。</p><h3 id="3-4-3-实体类（bean-层）"><a href="#3-4-3-实体类（bean-层）" class="headerlink" title="3.4.3 实体类（bean 层）"></a>3.4.3 实体类（bean 层）</h3><p>更多 Java -大数据 -前端 -python 人工智能资料下载，可百度访问：尚硅谷官网。</p><hr><h4 id="尚硅谷"><a href="#尚硅谷" class="headerlink" title="尚硅谷"></a>尚硅谷</h4><p>尚硅谷大数据项目之数据治理考评平台。</p><hr><h4 id="实体类的注解由-lombok-依赖提供。"><a href="#实体类的注解由-lombok-依赖提供。" class="headerlink" title="实体类的注解由 lombok_依赖提供。"></a>实体类的注解由 lombok_依赖提供。</h4><table><thead><tr><th>注解</th><th>位置</th><th>说明</th></tr></thead><tbody><tr><td>@NoArgsConstructor</td><td>类</td><td>增加无参构造函数。</td></tr><tr><td>@AllArgsConstructor</td><td>类</td><td>增加全参构造函数。</td></tr><tr><td>@Data</td><td>类</td><td>增加 getter setter 方法。</td></tr></tbody></table><h3 id="3-4-4-服务层-Service-层"><a href="#3-4-4-服务层-Service-层" class="headerlink" title="3.4.4 服务层 (Service 层)"></a>3.4.4 服务层 (Service 层)</h3><h4 id="3-4-4-1-职责"><a href="#3-4-4-1-职责" class="headerlink" title="3.4.4.1 职责"></a>3.4.4.1 职责</h4><ol><li>接收控制层调用。</li><li>处理业务。</li><li>返回结果。</li></ol><h4 id="3-4-4-2-注解说明"><a href="#3-4-4-2-注解说明" class="headerlink" title="3.4.4.2 注解说明"></a>3.4.4.2 注解说明</h4><table><thead><tr><th>注解</th><th>位置</th><th>说明</th></tr></thead><tbody><tr><td>@Service</td><td>类</td><td>声明该类为 Service 层 Spring 容器组件。</td></tr><tr><td>@Component</td><td>类</td><td>声明该类为 Spring 容器组件，功能上与 @Service 没有区别。</td></tr><tr><td>@Autowired</td><td>类</td><td>自动将 Spring 容器中的组件，装配到引用上。</td></tr></tbody></table><p>一个服务可能被多个控制层调用，因此服务层需要通用性，<br>servers层先建接口:<br>因为1   同一个接口可以由多个实现类  通过 @Qualifier(“customer2”)<br>      来选择适合的实现类<br>      早期也可以通过xml来选择<br>    2    用接口，成员可以完全不关心具体的实现类是什么<br>      在分布式系统场景，程序员完全不关心远端的实现类在哪 如何部署  ，减轻程序员开发负担 ，部署环境尽量不影响业务逻辑</p><p>在控制层调用服务层，不需要new 一个对象，而是通过 Spring 容器获取到服务层的对象(随着容器的启动，Spring 容器会自动创建对象)，然后调用其方法。用@Autowired 注解注入服务层对象。</p><p>1 容器（餐馆）   – 组件(员工)<br>    员工产生不会因为业务的调用 或者 其他员工的诞生而产生<br>     所有组件的创建(new)   由容器的启动时统一创建<br>  2  每个组件都是在容器中都是唯一的 ，单例模式（默认）</p><p>3   一般情况下 不要在单例组件上设置成员变量，因为成员变量是多线程共享的(多控制层调用同一个服务层)，如果要设置比如 计数器  集合 ，要注意线程安全。例如: int count &#x3D; 0 ;count++;变为AtomicInteger count &#x3D; new AtomicInteger(0); count.addAndGet(1);</p><p>mybatis :<br>1     帮助程序员  连接数据  ，connection  statement  一律省略</p><p> 2     封装参数  select  * from xxx where xxx &#x3D; ?        </p><p> 3     封装结果<br>          Customer    UserInfo   OrderInfo</p><pre><code>使程序员 专注于完成sql</code></pre><p>#{ }  一般就是用作参数传递   ,只传值 不传语句(类似jdbc中?)<br>  ${ }  一般用于动态拼接sql     ，可以传语句 </p><p>对单表做基础的查删改查   都不用再写sql了<br> mbp 提供了大量的crud 操作，包括mapper 层和 service层<br>无法实现join操作 ，union  ,子查询   ,with   …</p><p>mapper 建接口 mybatis帮你实现<br>数据源配置在application.properties中<br>和控制层调用服务层一样不用new 在service层用@Autowired 注解注入数据层对象。也可用BaseMapper,直接baseMapper.方法名()，(mybatis父类帮你创建了对象)</p><p>理论上控制层可以直接调mapper接口，但为了代码的可读性，还是建议用service层。</p><p>mybatis-plus:帮你写简单sql<br>在mapper接口上继承BaseMapper<T>  即可T :实体类<br>在service接口上继承IService<T> service实现类可以继承Serviceimpl&lt;xxBaseMapper,T&gt;  即可T :实体类 (可以) (可以避免service层写方法，在controller直接调用)<br>mybatis-plus 要求<br>每个java对象的属性和数据库字段必须一一对应<br>如果 某个Java属性不存在于数据库必须特殊声明<br><img src="https://img01.zzh36111.us.kg/20250223171101.png"></p><p>只改方法里的内容可以不用重启但要ctrl+f9刷新<br>如果该了注解或增加方法，需要重启项目。</p><p>java程序使用驼峰命名法，数据库字段使用下划线命名法。mybatis会自动将驼峰命名法转为下划线命名法。</p><p>json转换工具<br>Jackson     spring 默认<br> Gson       google </p><p>fastjson     Alibaba<br>JSON.toJSONString(object)  对象转json字符串<br>JSON.parseObject(jsonString, Class<T> clazz)  json字符串转对象</p><p>Mybatis-plus的代码生成工具</p><p>增加一个代码生成的工具类<br><a href="https://github.com/baomidou/generator">https://github.com/baomidou/generator</a></p><p>3.4.8 动态数据源<br>在实际开发中经常有面临一个Springboot应用要对接多个数据源的情况，但是如果通过配置完成多数据源与一个Springboot应用的连接实际上是非常繁琐的工作。<br>这里介绍一个动态数据源的工具dynamic-datasource。<br>这个工具只需要一个注解并配合简单的配置就可以实现一个Springboot对接多数据源。</p><p><img src="https://img01.zzh36111.us.kg/20250221170620.png"></p><p>在service层和 mapper的类上增加默认数据源(@Data(“dataSource1”))</p><p>在特定的方法上增加特定数据源<br>在 application.properties 中配置数据源信息</p><p>怎么看sql语句？<br>在aplication.properties中配置logging.level.com. … .mapper&#x3D;debug(debug模式下可以看到sql语句)</p><p>连接池<br>数据连接池的主要目的是当应用反复访问数据库时，不会每次都重复创建连接。而是复用已有的连接。</p><p>连接池  作用就是避免  用户因为操作数据库 反复建立连接<br>      连接池可以提前建立好连接  让用户从已有的连接池中借取<br>      使用完毕后 归还连接池  而连接不会被销毁<br>      n多个连接在池中循环使用  节省大量开销</p><p>在aplication.properties中配置连接池信息<br>再让使用连接池</p><p>lombok</p><p>apache lang3     google  guava<br>小工具包<br>字符串切割   日期转换  等等 。。</p><p>sql 注入：<br>列：delete  from  xxxx  where     id&#x3D;‘123’<br>页面传入  ‘ or 1&#x3D;1<br>则会执行 delete  from  xxxx  where     id&#x3D;‘‘ or 1&#x3D;1<br>为避免SQL注入问题增加工具类<br>把服务拼接好的sql传入，因为${}有sql注入风险，需要在拼接sql时处理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">filterUnsafeSql</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 替换 MySQL 中可能导致 SQL 注入的特殊字符</span></span><br><span class="line">        <span class="keyword">return</span> input.replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;\\\\&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\\&#x27;&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;\\\&quot;&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;\b&quot;</span>, <span class="string">&quot;\\b&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\\n&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\\r&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;\t&quot;</span>, <span class="string">&quot;\\t&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;\u001A&quot;</span>, <span class="string">&quot;\\Z&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;%&quot;</span>, <span class="string">&quot;\\%&quot;</span>)</span><br><span class="line">                .replace(<span class="string">&quot;_&quot;</span>, <span class="string">&quot;\\_&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>每增加一个指标</p><p>程序不需要改动任何一个已有类的代码<br>只需要增加一个新的类即可<br>低耦合 高内聚<br>开闭原则 ，对新增开发，对修改封闭<br>设计模式  模板模式<br><a href="https://www.w3cschool.cn/shejimoshi/template-pattern.html">详情点我</a></p><p>@Component标识该类会被创建为容器组件，同时给组件赋予了名字“TEC_OWNER” ，这个标识名称用于从容器中获得对应的指标考评器。<br>增加一个工具类用于从 Spring容器中获得组件</p><p>在要用的地方引入工具类，调用方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从容器中获得对应名称的组件</span></span><br><span class="line"><span class="type">Assessor</span> <span class="variable">assessor</span> <span class="operator">=</span> SpringBeanProvider.getBean(governanceMetric.getMetricCode(), Assessor.class);  </span><br><span class="line"><span class="comment">//根据名称获得spring容器中的组件</span></span><br></pre></td></tr></table></figure><p>在子类中增加注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;TEC_OWNER&quot;)</span></span><br></pre></td></tr></table></figure><p>添加工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBeanProvider</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123; </span><br><span class="line">  <span class="comment">//继承上下文工具组件，用于获得上下文容器</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">SpringBeanProvider</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取上下文对象，用于从容器中提取组件对象</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">            context = applicationContext;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从名称获取容器中的组件</span></span><br><span class="line">        <span class="keyword">public</span>  <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(String name,Class&lt;T&gt; aClass)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> context.getBean(name,aClass);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正则表达式<br>作用：  判断一个字符串符不符合 某种格式 </p><p>开头  ：一个字符串   含数字 英文大小_   至少有1个字符       表开头:^[a-zA-Z0-9_]    ^\w+<br>紧接着  @<br>紧接着：一个字符串   含数字 英文大小_   1到 16个  \w{1,16}<br>接着 :   .                 注意 . 有特殊含义 标识任意一个字符<br>结尾：  要求   com或者cn  org   （练习）</p><p>^\w+@\w{1,16}.$(com|cn|org)</p><p>工具类的特点<br>1   不耦合业务逻辑  </p><p>2    无状态 （连接，属性）</p><p>字符串.indexOf() 方法：<br>返回指定字符串在当前字符串中第一次出现的索引位置，如果当前字符串中不包含指定字符串，则返回 -1。</p><p>sql解析器</p><p>如何分析sql<br>1   把sql 变为结构体<br>        语法树     解析语法树工具 最好  sql 是使用数据库 匹配<br>         遍历器    用遍历器去访问语法数据</p><pre><code>     自定义节点处理器 （业务逻辑）  把节点处理器放到遍历器中·</code></pre><p>2  基于sql结构体 进行遍历检查<br>左右中<br>添加工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlParser</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> dispatcher  自定义节点处理器</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> sql    待分析的sql</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sqlParse</span><span class="params">(Dispatcher dispatcher, String sql )</span>   &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 解析 Hive SQL</span></span><br><span class="line">            <span class="type">ParseDriver</span> <span class="variable">parseDriver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParseDriver</span>(); <span class="comment">//创建解析引擎</span></span><br><span class="line">            <span class="comment">//执行解析  得到根节点</span></span><br><span class="line">            <span class="type">ASTNode</span> <span class="variable">ast</span> <span class="operator">=</span>  parseDriver.parse(sql);</span><br><span class="line">            <span class="comment">//  找到查询的根节点下的TOK_QUERY节点，视为有效根节点</span></span><br><span class="line">            <span class="keyword">while</span> (ast.getToken() == <span class="literal">null</span> || ast.getToken().getType() != HiveParser.TOK_QUERY) &#123;</span><br><span class="line">                ast = (ASTNode) ast.getChild(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 把节点处理器注入一个图形遍历器   使用自定义处理器遍历抽象语法树</span></span><br><span class="line">            <span class="type">GraphWalker</span> <span class="variable">ogw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultGraphWalker</span>(dispatcher);</span><br><span class="line">            <span class="comment">// 用遍历器遍历整个语法树</span></span><br><span class="line">            ogw.startWalking(Collections.singletonList(ast), <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>异步编排</p><p>列如：求integer[] nums&#x3D;{1,2,3,4,5}的平方和</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//线程池</span></span><br><span class="line"><span class="keyword">static</span> ThreadPoolExecutor threadPoolExecutor= <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">10</span>,<span class="number">20</span>,<span class="number">60</span>, TimeUnit.SECONDS,<span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;());</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       Integer[] nums= &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">       <span class="comment">//取6个数的平方  然后加总    //假设每次取平方是复杂运算 每次需要计算5秒</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">startTs</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       <span class="comment">//创建CompletableFuture列表</span></span><br><span class="line">       List&lt;CompletableFuture&lt;Integer&gt;&gt; completableFutureList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//for循环不会等待所有任务完成  而是立即返回一个CompletableFuture对象</span></span><br><span class="line">       <span class="keyword">for</span> (Integer num : nums) &#123;</span><br><span class="line">           CompletableFuture&lt;Integer&gt; completableFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">               <span class="comment">//计算逻辑 并且有返回值  此处逻辑 开始 /////// //全部为异步执行，不会阻塞其他程序 包括外层循环</span></span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">               &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> num * num;</span><br><span class="line">               <span class="comment">/// //////////////////  异步程序结束</span></span><br><span class="line">           &#125;, threadPoolExecutor);</span><br><span class="line">           <span class="comment">//添加到CompletableFuture列表</span></span><br><span class="line">           completableFutureList.add(completableFuture);</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//等待所有任务完成  并获取求和的结果</span></span><br><span class="line">       List&lt;Integer&gt; integerList = completableFutureList.stream().map(future -&gt; future.join()).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">       Integer total=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (Integer num : integerList) &#123;</span><br><span class="line">           total+=num;</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(total);</span><br><span class="line">       System.out.println(<span class="string">&quot;System.currentTimeMillis()-startTs = &quot;</span> + (System.currentTimeMillis() - startTs));</span><br><span class="line">       <span class="comment">//输出结果比30秒快  因为有并行计算</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>调度<br>11.5.1 springtask介绍<br>springtask是springboot框架中自带的时间调度程序。<br>优点：简单易用配置少。<br>缺点：不能做分布式调度</p><p>11.5.1.1 如何启用<br>在springboot启动程序上增加注解 @EnableScheduling</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// 启动调度</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  建立一个任务类，类上面增加@Component,在方法上增加表达式。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.time.DateFormatUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/10 * * * * *&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">text1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;text1 测试&quot;</span>+DateFormatUtils.format(<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="string">&quot;mm:ss&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">text2</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;text2 测试&quot;</span>+ DateFormatUtils.format(<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="string">&quot;mm:ss&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">text3</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;text3 测试&quot;</span>+DateFormatUtils.format(<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="string">&quot;mm:ss&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Scheduled(initialDelay =3000,  fixedRate = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">text4</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;text4 测试&quot;</span>+DateFormatUtils.format(<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="string">&quot;mm:ss&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>11.5.1.2 如何配置<br>@Scheduled可用的参数<br> cron 表达式 标识 “秒 分 时 天 月 星期几”。<br> fixedDelay标识 每次触发的固定间隔毫秒数，注意间隔为是前一次的结束时间到后一次的开始时间点的间隔。<br> fixedRate  标识 每次触发的固定间隔毫秒数，注意间隔为是前一次的开始时间到后一次的开始时间点的间隔。 如果后一次开始时前一次的任务还没做完，则后一次的处理会被阻塞，直到前一任务完成。<br> initialDelay 标识每次启动时初始的延迟， 可以配合fixedDelay 或者fixedRate使用</p><p>取配置文件中的自定义参数</p><p> @Value(“${assess.schemas}”)<br>    String schemas&#x3D;null;</p><p>在spring中dbug时要进入一个方法，最好不要用f7，在spring中 进入访问体验不好 因为方法可能被框架拦截，进入方法前 提前 用ctrl+alt+b  进入方法的实现类 打断点<br>     再用F9 继续执行到该位置</p><p>报错优先看最后一个Caused by </p><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 数据中台技术<p>date: 1739787588000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>数据治理</title>
      <link href="/wenzhang/%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86/"/>
      <url>/wenzhang/%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="数据治理考评平台"><a href="#数据治理考评平台" class="headerlink" title="数据治理考评平台"></a>数据治理考评平台</h3><p>考评平台内部主要由两部分组成。</p><ul><li>一部分是最核心的“考评核算引擎”，主要功能是结合考评平台数据考核参数以及各个数据组件的相关信息，比如Hive元数据库、DolphinScheduler 中配置的任务信息、任务完成状况、 HDFS集群的相关信息，进行考评最终核算出分数，并进行保存。</li><li>另一部分是服务于外部访问的请求，比如查看考评、维护参数、补充元数据等等<br><img src="https://img01.zzh36111.us.kg/20250217180430.png" alt="架构图"></li></ul><h3 id="项目背景："><a href="#项目背景：" class="headerlink" title="项目背景："></a>项目背景：</h3><p>随着大数据技术的广泛应用，企业搭建了各种数据仓库、数据湖，但由于数据源复杂、口径不统一等问题，导致数据质量低、数据孤岛严重、安全风险高。因此，数据治理成为企业必不可少的环节。本项目旨在建立一套数据治理考评平台，以评估和优化企业的数据治理水平。</p><h3 id="项目目标："><a href="#项目目标：" class="headerlink" title="项目目标："></a>项目目标：</h3><p>量化数据治理效果，提供标准化评分体系<br>发现并改善数据质量、规范性、安全性等问题<br>通过自动化考评减少人工干预，提高治理效率</p><h3 id="核心功能："><a href="#核心功能：" class="headerlink" title="核心功能："></a>核心功能：</h3><ol><li>数据考评指标体系</li></ol><p>规范性（如表命名规范、字段备注）<br>存储管理（如生命周期、空表检测）<br>计算质量（如长期无产出、计算报错）<br>数据质量（如数据产出时效、数据量监控）<br>安全性（如权限管理、安全等级）</p><h1 id="数据治理考评指标"><a href="#数据治理考评指标" class="headerlink" title="数据治理考评指标"></a>数据治理考评指标</h1><p>在数据治理考评平台中，我们将考评指标分为五个大类：<strong>规范、存储、计算、质量、安全</strong>，并针对不同考核项进行打分评估。</p><h2 id="1-规范-Standardization"><a href="#1-规范-Standardization" class="headerlink" title="1. 规范 (Standardization)"></a>1. 规范 (Standardization)</h2><table><thead><tr><th>考评指标</th><th>评分标准</th><th>需要信息</th></tr></thead><tbody><tr><td>有技术负责人 (Technical Owner)</td><td>有则10分，无则0分</td><td>元数据</td></tr><tr><td>有业务负责人 (Business Owner)</td><td>有则10分，无则0分</td><td>元数据</td></tr><tr><td>表名是否合规 (Table Naming Compliance)</td><td>参考数仓表规范，不合规0分，部分合规5分，完全合规10分</td><td>元数据</td></tr><tr><td>表有备注 (Table Comment)</td><td>有则10分，无则0分</td><td>元数据</td></tr><tr><td>字段有备注信息 (Column Comment)</td><td>(备注字段数 &#x2F; 总字段数) * 10分</td><td>元数据</td></tr></tbody></table><h2 id="2-存储-Storage"><a href="#2-存储-Storage" class="headerlink" title="2. 存储 (Storage)"></a>2. 存储 (Storage)</h2><table><thead><tr><th>考评指标</th><th>评分标准</th><th>需要信息</th></tr></thead><tbody><tr><td>生命周期合理 (Lifecycle Management)</td><td>未设置生命周期0分，普通生命周期10分，超长存储5分</td><td>元数据</td></tr><tr><td>是否为空表 (Empty Table)</td><td>空表0分，有数据10分</td><td>元数据</td></tr><tr><td>存在相似表 (Duplicate Tables)</td><td>相似表字段重复率超过一定百分比则0分，否则10分</td><td>元数据</td></tr></tbody></table><h2 id="3-计算-Computation"><a href="#3-计算-Computation" class="headerlink" title="3. 计算 (Computation)"></a>3. 计算 (Computation)</h2><table><thead><tr><th>考评指标</th><th>评分标准</th><th>需要信息</th></tr></thead><tbody><tr><td>长期无产出 (Inactive Data)</td><td>近{days}天内无数据产出0分，否则10分</td><td>HDFS</td></tr><tr><td>长期无访问 (Unused Data)</td><td>近{days}天内无访问0分，否则10分</td><td>HDFS</td></tr><tr><td>计算任务有报错 (Job Errors)</td><td>任务执行有报错0分，无报错10分</td><td>任务信息</td></tr><tr><td>简单加工 (Simple Processing)</td><td>SQL无 <code>JOIN</code> &#x2F; <code>GROUP BY</code> &#x2F; 过滤操作则0分，否则10分</td><td>任务信息</td></tr></tbody></table><h2 id="4-质量-Data-Quality"><a href="#4-质量-Data-Quality" class="headerlink" title="4. 质量 (Data Quality)"></a>4. 质量 (Data Quality)</h2><table><thead><tr><th>考评指标</th><th>评分标准</th><th>需要信息</th></tr></thead><tbody><tr><td>表产出时效监控 (Data Timeliness)</td><td>产出时间超过历史均值一定比例则0分，否则10分</td><td>任务信息</td></tr><tr><td>表产出数据量监控 (Data Volume)</td><td>产出数据量超出历史均值上下限则0分，否则10分</td><td>HDFS</td></tr></tbody></table><h2 id="5-安全-Security"><a href="#5-安全-Security" class="headerlink" title="5. 安全 (Security)"></a>5. 安全 (Security)</h2><table><thead><tr><th>考评指标</th><th>评分标准</th><th>需要信息</th></tr></thead><tbody><tr><td>未明确安全等级 (Undefined Security Level)</td><td>未设置0分，已设置10分</td><td>元数据</td></tr><tr><td>目录文件访问权限 (Access Control)</td><td>目录或文件权限超出建议范围则0分，否则10分</td><td>HDFS</td></tr></tbody></table><hr><h2 id="评分规则"><a href="#评分规则" class="headerlink" title="评分规则"></a>评分规则</h2><p>数据治理考评平台会按照上述考评指标对企业的数据治理情况进行自动评估，并计算出最终得分，帮助企业发现问题并持续优化数据管理策略。</p><ol start="2"><li>考评引擎</li></ol><p>结合Hive元数据、HDFS存储信息、DolphinScheduler任务信息等计算评分<br>自动扫描数据仓库并生成考评报告<br>3. 数据治理可视化</p><p>通过Web页面展示各类考评指标及得分<br>详细展示每张表的元数据、存储情况、访问记录等<br>3. 技术栈：</p><p>后端：Spring Boot、MyBatis-Plus、MySQL<br>大数据组件：Hive、HDFS、DolphinScheduler<br>前端：基于Vue.js的可视化界面<br>4. 项目亮点：</p><p>量化考评机制：采用打分体系量化数据治理状况，清晰展示问题点<br>自动化数据获取：结合Hive、HDFS等多源数据，实时更新考评结果<br>高扩展性：支持定制考评规则，可适配不同企业需求</p><p><img src="https://img01.zzh36111.us.kg/20250222155904.png"></p><p>提取元数据(每天提取一次)<br>1  明确要提取哪些数据 （ 尽量覆盖，1 考评指标的要求，2 一般用户需要查看的内容）<br>2  根据要提取的数据建立目标表 (create table)<br>3   建立project , springboot 项目<br>4   依赖<br>5   根据表 生成代码<br>6    提取元数据业务逻辑编写<br>6.1   hive元数据 </p><ul><li><p>创建hiveclient(帮你查询hive元数据，你也可以自己写)</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://hadoop102:3306/metastore?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>000000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.schema.verification<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.event.db.notification.api.auth<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.header<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.current.db<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spark依赖位置（注意：端口号8020必须和namenode的端口号一致）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.yarn.jars<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:8020/spark-jars/*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--Hive执行引擎--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.execution.engine<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.dynamic.partition<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Whether or not to allow dynamic partitions in DML/DDL.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.dynamic.partition.mode<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>nonstrict<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">        In strict mode, the user must specify at least one static partition</span><br><span class="line">        in case the user accidentally overwrites all partitions.</span><br><span class="line">        In nonstrict mode all partitions are allowed to be dynamic.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.client.socket.timeout<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- hiveserver2的高可用参数，开启此参数可以提高hiveserver2的启动速度 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.active.passive.ha.enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableMetaInfoServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;TableMetaInfoMapper, TableMetaInfo&gt; <span class="keyword">implements</span> <span class="title class_">TableMetaInfoService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">IMetaStoreClient</span> <span class="variable">hiveClient</span> <span class="operator">=</span> getHiveClient();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 hive 客户端</span></span><br><span class="line"><span class="keyword">private</span> IMetaStoreClient <span class="title function_">getHiveClient</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">HiveConf</span> <span class="variable">hiveConf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiveConf</span>();</span><br><span class="line"></span><br><span class="line">    hiveConf.addResource(Thread.currentThread().getContextClassLoader().</span><br><span class="line">            getResourceAsStream(<span class="string">&quot;hive-site.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">IMetaStoreClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// true表示用hive访问metaStore，false表示用metaserver访问metaStore</span></span><br><span class="line">        client = RetryingMetaStoreClient.getProxy(hiveConf, <span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> client;</span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>获取hive元数据<br>元数据到数据库表里<br>hdfs元数据 </p></li><li><p>创建hdfs客户端</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取hdfs客户端</span></span><br><span class="line"><span class="type">FileSystem</span> <span class="variable">fs</span> <span class="operator">=</span> FileSystem.get(<span class="keyword">new</span> <span class="title class_">URI</span>(tableFsPath), <span class="keyword">new</span> <span class="title class_">Configuration</span>(), tableFsOwner);</span><br><span class="line"><span class="comment">// 获取当前目录或文件信息的状态</span></span><br><span class="line">FileStatus[] fileStatuses = fs.listStatus(curPathFileStatus.getPath());</span><br></pre></td></tr></table></figure><ul><li>获取hdfs元数据</li><li>元数据到数据库表</li></ul><p>元数据附加信息</p><ul><li>每张表一条数据(不用每天录入，其中有些信息可以通过hive或hdfs元数据获取，就不用都手动录入了)</li></ul><p>保存元数据<br>7    保存到数据库表里 </p><p>要给用户提供对于元数据管理界面<br>查看和修改  任务2</p><p>页面列表查询<br>参数部分<br>1    涉及到 根据条件搜索  库名 表名  分层<br>2     分页   ：   第几页   和 每页多少行</p><p>结果部分<br>    1  这些字段    在哪几张表   table_meta_info  table_meta_info_extra<br>    2  不考虑分页情况的总行数</p><p>为了避免join  可以不可以<br>先查出一个列表<br>然后再遍历这个列表<br>   用列表的每个元素 查询数据  获得 结果 对元素进行补充。</p><p>页面操作   即席查询 操作<br>     不要循环操作数据库<br>     尽量组合成 join  一次提交    </p><p>在bean里加上以下表示下面这个字段是不在数据库里的，让mybatis不去映射这个字段。<br>@Tablefield(exist &#x3D; false)<br>private List<TableMetaInfoExtra> extraList;<br>数据库表 join操作的结果 如何 封装到一个主子类 中<br>策略<br>还是使用sql 进行join操作<br> 1  要区分出同名的字段 每个同名字段单独起别名<br> 2   其他可以※    ，最好还是别写 *<br>  3  使用mapper.xml进行映射<br> 4    映射分两部分  Java属性和字段名 不一致的需要手动映射<br>其他的可以自动映射<br>          association  是负责 子对象映射关键词<br>5  配置<br>application.properties</p><p>如果要查多张表，就不建议用先查一张表，另外一张表查出来用set，因为要用循环，每一次循环都要连接数据库，效率低。<br>所有用join查询，但如何把两个表的字段分别对应起来</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot; select tm.id as tm_id ,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;tm.schema_name as tm_schema_name, &quot; +</span></span><br><span class="line"><span class="meta">        &quot;tm.table_name as tm_table_name,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;tm.create_time as tm_create_time,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;tm.update_time as tm_update_time,&quot; +</span></span><br><span class="line"><span class="meta">        &quot; te.id as te_id ,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;te.schema_name as te_schema_name ,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;te.table_name as te_table_name,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;te.create_time as te_create_time,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;te.update_time as te_update_time,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;    tm.* ,te.* from  table_meta_info tm join table_meta_info_extra te&quot; +</span></span><br><span class="line"><span class="meta">        &quot; on tm.table_name=te.table_name and tm.schema_name=te.schema_name &quot; +</span></span><br><span class="line"><span class="meta">        &quot; where assess_date= (select max(assess_date)  from table_meta_info  )&quot;</span></span><br><span class="line"><span class="meta">         )</span></span><br><span class="line"><span class="meta">@ResultMap(&quot;meta_map&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TableMetaInfo&gt; <span class="title function_">selectTableMetaInfoAllList</span><span class="params">( )</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.dga.meta.mapper.TableMetaInfoMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;meta_map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.zzh.dga.meta.bean.TableMetaInfo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tm_id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;schemaName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tm_schema_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;tableName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tm_table_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tm_create_time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tm_update_time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;tableMetaInfoExtra&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.zzh.dga.meta.bean.TableMetaInfoExtra&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;te_id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;schemaName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;te_schema_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;tableName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;te_table_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;te_create_time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;te_update_time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>还要在application.yml里配置mybatis的mapper扫描路径</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设定自动映射行为 ：FULL标识对象存在嵌套的情况</span></span><br><span class="line"><span class="string">mybatis.configuration.auto-mapping-behavior=FULL</span></span><br><span class="line"><span class="comment">#映射文件所在位置</span></span><br><span class="line"><span class="string">mybatis.mapper-locations=classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><p>任务四：根据考评结果计算分数</p><p>指标计算 优化<br>1  可以把在指标计算过程中可以复用计算 ，提取出来，提前统一计算</p><p>2  指标和指标间的计算 存不存在依赖关系： 不存在依赖关系<br>    100张表 *20指标  2000次指标考评计算<br>     并行 </p><p>考评用多线程，但我统计考评分数要统一统计<br>如何 让多线程处理 完成  集结 在进行统一的处理进行<br>1.8以前的java    countdown </p><p>异步编排 </p><p>任务三： 对每张表每个指标进行考评<br><img src="https://img01.zzh36111.us.kg/20250224150730.png"></p><p>1     把数仓元数据提取出来   table_meta_info   table_meta_info_extra  </p><p>2      把指标清单提取出来   governance_metrics </p><p>3     元数据列表和指标列表  双层循环   依次 进行考评 </p><p>4    获得一个 考评结果明细列表   进行保存 </p><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 数据治理<p>date: 1739775481000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>数据中台</title>
      <link href="/wenzhang/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0/"/>
      <url>/wenzhang/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<p>json web token为了防止每次访问都登录，所以需要在客户端存储token，然后每次请求都带上token。</p><p>lambook少用</p><ol><li>应为它帮你插入什么你并不知道，还会导致代码混乱。(可能会插入equlas,hashcode等方法)</li><li>record语法出现</li></ol><p>get请求参数放在url中，post请求参数放在body中，get请求参数长度有限制，post请求参数长度无限制。<br>get会被浏览器缓存，post不会被缓存。</p><p>任务调度模块：</p><ol><li>定时任务：定时任务是指在指定的时间执行某些操作，比如每天凌晨1点执行某个任务。(cron表达式)</li><li>周期任务：周期任务是指按照固定时间间隔执行某些操作，比如每隔1小时执行某个任务。(quartz框架)</li><li>DAG任务：DAG任务是指有向无环图，它是一种任务调度模型，它将任务分解成多个子任务，每个子任务之间有依赖关系，只有前置任务执行完成后，才能执行后置任务。(airflow)</li></ol><p>为什么不用java timer？<br>因为java timer,如果java程序异常宕机，timer任务不会执行<br>quartz<br>可以将任务持久化到mysql数据库</p><p>antlr4</p><p>sql -&gt; 词法分析 -&gt; 标记流 -&gt; 语法分析 -&gt; 抽象语法树 -&gt; 语义分析 -&gt; 语义分析(类型检查) -&gt; 执行计划 -&gt; 将执行计划转换为物理计划 -&gt; 物理执行 -&gt; 结果集 -&gt; 输出</p><p>为什么不用mysql？<br>查询复杂</p><p>图数据库(专门用于处理图关系数据库)<br>neo4j，查询语言cypher不是sql</p><p>使用ai</p><ul><li>让ai复述需求</li><li>明确需求范围</li><li>需求拆解</li><li>把ai当小孩子，一步一步的教他</li></ul><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 数据中台<p>date: 1739254507000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>大数据优化</title>
      <link href="/wenzhang/%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BC%98%E5%8C%96/"/>
      <url>/wenzhang/%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>主维表和相关维表关联时在不影响结果的情况下，尽量用left join，避免使用join。因为要保证相关维表丢数据影响主维表数据</p><p>两表join时，先where条件过滤，再join，避免join后数据量过大。</p><p>使用union all来合并数据(不影响结果的情况下)，而不是union，因为union会去重，增加负担。</p><p>用查询的方式修改数据，不用update语句</p><p>性能如何提升？</p><ul><li>join</li><li>可以减少数据量</li><li>存在重复计算</li><li>数据重复读取</li></ul><p>所有在nd表中用1d表减少重复计算</p><p>用炸裂函数减少io次数</p><ol><li>获取时间范围最大的数据集</li><li>将查询的数据集在内存中进行炸裂处理</li><li>将炸裂后的结果集筛选出有用的数据</li><li>将筛选后的数据照标记进行分组统计</li></ol><p>在7d和30d表中用1d表，30d表也算了7d表，可以加if判断，在30d表中算7d，但字段会变多</p><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 大数据优化<p>date: 1738671432000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux中出错处理方法</title>
      <link href="/wenzhang/Maxwell%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95/"/>
      <url>/wenzhang/Maxwell%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="0-前言：这是错误的通用处理方法，我以maxwell启动失败为例，请根据具体情况进行调整。"><a href="#0-前言：这是错误的通用处理方法，我以maxwell启动失败为例，请根据具体情况进行调整。" class="headerlink" title="0. 前言：这是错误的通用处理方法，我以maxwell启动失败为例，请根据具体情况进行调整。"></a>0. 前言：这是错误的通用处理方法，我以maxwell启动失败为例，请根据具体情况进行调整。</h2><h2 id="1-查看日志文件"><a href="#1-查看日志文件" class="headerlink" title="1. 查看日志文件"></a>1. 查看日志文件</h2><p>找到maxwell的日志文件，一般在<code>~/maxwell/logs</code>目录下，根据具体情况进行调整。<br><img src="https://img01.zzh36111.us.kg/20250129160756.png" alt="这是我的日志文件目录"></p><h2 id="2-排查错误原因"><a href="#2-排查错误原因" class="headerlink" title="2. 排查错误原因"></a>2. 排查错误原因</h2><p>根据日志文件，找到error关键字，一般会有具体的错误原因。<br><img src="https://img01.zzh36111.us.kg/20250129161206.png" alt="这是我的日志文件中的error关键字"></p><h2 id="3-处理错误"><a href="#3-处理错误" class="headerlink" title="3. 处理错误"></a>3. 处理错误</h2><p>复制错误原因到搜索引擎或GPT，根据搜索结果进行错误处理。<br><img src="https://img01.zzh36111.us.kg/20250129162411.png" alt="根据GPT搜索结果排查下来发现是mysqlbinglog的配置问题"></p><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: linux中出错处理方法<p>date: 1738137508000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>梳理</title>
      <link href="/wenzhang/%E6%A2%B3%E7%90%86/"/>
      <url>/wenzhang/%E6%A2%B3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<ol><li>虚拟数据生成<br>&#x2F;opt&#x2F;module&#x2F;data_mocker目录下改<br>application.yml文件中的日期</li></ol><p>2.1 日志数据采集到kafka<br><code>这里加一个kafka的原因是：一是为了给实时数仓用，二是如果不加kafka,多个flume采集数据到hdfs如果文件重名，会导致数据写进hdfs失败(因为hdfs不支持随机写)，如果用flume聚合会导致第二个flume的source和sink传输数率不一致，导致chinle爆掉</code><br>2.2 业务数据采集到kafka<br>3. 从kafka把日志数据消费数据到hdfs<br>3.2 从kafka把业务数据消费数据到hdfs</p><ol start="4"><li>数仓建设(逻辑分层，物理没有分层)<br>4.1 ods建设</li></ol><p>4.1.1 为什么要建设ODS层？</p><p>因为我们的数仓需要数据，但是无法直接从业务系统获取<br>原因：1.业务数据库行式存储，数据仓库需要列式存储<br>      2.业务数据库不可以存储大量数据，数据仓库需要存储大量数据提升统计分析的准确性<br>      3.不应该让业务数据库对接数据仓库从而增加业务系统的负担</p><p>4.1.2 ODS层建设要点<br>因为我们想让统计分析的时间更长，所有需要采集的时间相对更短，所以我们让ods与业务系统同步数据，<strong>尽</strong>可能不变</p><ol><li>存储方式不要变</li><li>数据格式不要变</li><li>压缩格式不要变<br>可以变的</li><li>融合异构数据(列：要把日志数据存到一张表中，但是日志数据有不同的字段，所以要融合)</li><li>汇总不同时间数据(列：日志数据有不同的时间，需要汇总到一张表中)</li></ol><p>ODS层的设计格式如下：<br>（1）ODS层的表结构设计依托于从业务系统同步过来的数据结构。<br>（2）ODS层要保存全部历史数据，故其压缩格式应选择压缩比较高的，此处选择gzip。<br>（3）ODS层表名的命名规范为：ods_表名_单分区增量全量标识（inc&#x2F;full）。</p><p>4.1.3 日志数据表字段建设<br>日志数据为json格式，json表字段选最外层json对象属性为表字段，它是json的结构，所以用特殊类型</p><p>4.1.4 业务数据表字段建设<br>ods为数据仓库的数据源</p><p>4.2 dim建设(主要功能是分析数据：面相状态)</p><p>4.2.1 为什么要建设dim层？<br>因为不同的需求可以在同一个维度(角度)上进行分析，所有维度可能重复使用为了避免重复计算，所以我们建设dim层，为统计分析提供数据支撑。</p><p>DIM层设计要点：<br>（1）DIM层的设计依据是维度建模理论，该层存储维度模型的维度表。<br>（2）DIM层的数据存储格式为orc列式存储+snappy压缩。(因为经常要统计分析)<br>（3）DIM层表名的命名规范为dim_表名_全量表或者拉链表标识（full&#x2F;zip）</p><p>4.2.1 全量维度表建设<br>为什么用全量维度表？<br>数据仓库的一个重要特点就是反映历史的变化，所以如何保存维度的历史状态是维度设计的重要工作之一。所有要保存维度数据的历史状态，所以可以每天保存一份全量的维度数据。</p><p>为什么用拉链表？<br>拉链表的意义就在于能够更加高效的保存维度信息的历史状态(比全量表更加节省空间)<br>数据源为增量表(因为全量表得变化数据及其困难)</p><ol><li>确定维度（表）<br>在设计事实表时，已经确定了与每个事实表相关的维度，理论上每个相关维度均需对应一张维度表。需要注意到，可能存在多个事实表与同一个维度都相关的情况，这种情况需保证维度的唯一性，即只创建一张维度表。另外，如果某些维度表的维度属性很少，例如只有一个**名称，则可不创建该维度表，而把该表的维度属性直接增加到与之相关的事实表中，这个操作称为维度退化</li><li>确定主维表和相关维表(在业务数据库中查看)</li></ol><ul><li>主维表：主维表是指维度表的最底层，它存储维度的基本信息，比如维度名称、维度代码、维度描述等。</li><li>相关维表：相关维表是指维度表的中间层，它存储维度的关联信息，比如维度与主维表的关联关系、维度与其他维度的关联关系等。</li></ul><ol><li>确定维度属性(选择出可以用来分析的维度属性，主要看业务需求)</li></ol><ul><li>尽可能生成丰富的维度属性(列存储不会降低效率，但是会增加磁盘占用)</li><li>尽量不使用编码，而使用明确的文字说明，一般可以编码和文字共存(因为我们并不知道编码的含义)</li><li>尽量沉淀(计算)出通用的维度属性</li></ul><p>4.2.2 拉链维度表建设</p><p>4.3 dwd建设(主要功能是统计数据：面相行为)<br>4.3.1 为什么要建设dwd层？<br>对ods层的数据进行清洗、转换、加工，为后面统计分析做准备。<br>(这里加工为一个广泛概念，所有没有具体操作)</p><p>dwd主要保存业务行为数据(事实表)</p><p>大多数表是增量表，少部分是全量表</p><p>DWD层设计要点：<br>（1）DWD层的设计依据是维度建模理论，该层存储维度模型的事实表。<br>（2）DWD层的数据存储格式为orc列式存储+snappy压缩。(因为经常要统计分析)<br>（3）DWD层表名的命名规范为dwd_数据域_表名_单分区增量全量标识（inc&#x2F;full）</p><p>事实表应该包含以下信息：</p><ul><li>包含维度信息：维度越多描述行为越详细</li><li>包含度量值：所有行为必须可以用来统计，用来统计的值就是度量值</li></ul><p>设计事务事实表时一般可遵循以下四个步骤：</p><ul><li>选择业务过程：确定什么表</li><li>声明粒度：确定行</li><li>确认维度：确定列</li><li>确认事实：确定度量值</li></ul><p>4.4 dws建设<br>4.4.1 日志数据建设</p><p>4.4.2 业务数据建设<br>4.5 ads建设</p><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 梳理<p>date: 1738130258000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>建模</title>
      <link href="/wenzhang/%E5%BB%BA%E6%A8%A1/"/>
      <url>/wenzhang/%E5%BB%BA%E6%A8%A1/</url>
      
        <content type="html"><![CDATA[<ol><li>熟悉业务<br>MySQL保存的不是行为数据，而是实体数据，状态数据。</li></ol><p>数据源-》数据加工-》数据统计-》数据分析-》数据展示-》数据决策</p><p>为什么分多成，因为一个指标可能要重复运算</p><p>数据采集当天计算所以要求数据采集占用时间短，所以ods与采集到的数据格式尽可能不变</p><ol><li>存储方式</li><li>数据格式</li><li>压缩方式<br>有些可以变</li><li>融合异构</li><li>汇总不同时间数</li></ol><p>数仓目的是分析<br>分层设计为了使数据体系更加清晰，便于管理。</p><p>因为有很多数据重复所以有维度dim</p><ol><li>er：使用面向对象的方式设计表在</li><li>1对多的关系，多的表中建外键比在多的表中建外键查询更高效。</li><li>1对1：主外键相同</li><li>多对多采用两张表很难实现，第三张表中建立两个外键，分别指向主表和从表。</li></ol><p>3nf<br>函数依赖</p><p>1nf：每个属性都只包含一个值。不可分解。<br>2nf：在1nf基础上，非主属性不能直接依赖于主键。<br>3nf：在2nf基础上，任何非主属性不能传递依赖于主键。 </p><p>er模型表太多，不适合统计分析，所以需要维度建模进行分层设计。</p><ol start="5"><li>维度：</li><li>数据统计：汇总数据（行为的结果）——–事实表</li><li>数据分析：角度（状态）———维度表</li></ol><p>分层设计是逻辑分层，按表名分层。</p><p>ods主要存储所以用gzip压缩效率较高，且不用格式转换，且不用格式转换就可以建表<br>指定表位置方便管理<br>为什么用外部表？<br>看是否有别人一起用<br>分区表：按时间分区，方便查询，提高查询效率。（不用分区，会生成多文件，大文件，查询时会扫描所有文件，效率低）<br>分区字段不会存到文件会放到路径中，所以使用采用分区表<br>设置严格的权限控制，防止误操作<br>日志表字段怎么选？<br>如果json属性和表字段相同，可以正常解析<br>如果json属性少表字段存在的可以正常解析不存在的解析为null<br>如果json属性多表字段不存在的不解析<br>如果json属性和表字段不区分大小写，可以正常解析</p><p>所以json表字段选最外层json对象属性为表字段，它是json的结构，所以用特殊类型</p><p>map 与 struct 区别<br>map：value类型统一，key个数可以变<br>struct：value类型可以不统一，key个数固定</p><p>时间戳，10位为秒，13位为毫秒用bigint存储</p><p>因为 datebase,table 属性与业务无关所以建表时不要</p><p>ods是数仓数据源，dim和dwd才是统计分析数据源</p><p>dim表：<br>应该为列存储适合统计，hive：orc<br>所以压缩应该snappy<br>全量<br>状态数据为了避免出现问题最好每天存一份全部数据（绝大多数都维度表是全量表）<br>拉链<br>维度表<br>把有关联维度放到一张维度表，避免关联查询<br>如果维度表特别简单，可以不建维度表，直接在事实表中关联<br>只要可以用来分析的维度都是字段<br>确定字段来源（参考业务数据库的字段）<br>主维度：业务数据库主要分析字段的表<br>相关维度：业务数据库中存在关联关系的表<br>确定维度表字段：<br>字段越多越好（列存储不会影响查询效率）<br>编码和文字共存，<br>沉淀(计算)出通用属性</p><p>记得装载数据用 insert overwrite，不要用 insert into，因为insert into会导致数据重复。</p><p>数仓经常需要统计历史数据所有需要存储历史维度</p><p>全量快照表<br>1）离线数据仓库的计算周期通常为每天一次，所以可以每天保存一份全量的维度数据。这种方式的优点和缺点都很明显。<br>优点是简单而有效，开发和维护成本低，且方便理解和使用。<br>缺点是浪费存储空间，尤其是当数据的变化比例比较低时。大量数据没有变化<br>2）拉链表(要数据变化不频繁时)<br>拉链表的意义就在于能够更加高效的保存维度信息的历史状态</p><p>首日获取的全量数据只要用户的最新状态数据，不存在历史的状态数据，无法判断状态的开始<br>所有折中的认为首日就是当前状态的开始日期</p><p>分区策略<br>将数据存到结束时间所在分区</p><p>当天多次修改怎么办？</p><p>dwd层：</p><p>建表时进可以让粒度更细</p><p>事实表分类：<br>事务型事实表<br>绝大多数事实表</p><p>特殊需求，用以下方式建表为了提高效率：</p><p>周期性快照事实表：(特殊需求不需要关联计算直接如存量指标：存款，直接从业务数据库中周期性获取)因为特殊需求可能需要多个行为关联得到，所有有周期快照事实表</p><ul><li>日度快照事实表：每天更新一次(保存2状态数据，存量数据)</li><li>问为什么不作为维度表？因为这是度量值</li></ul><p>累计型快照事实表：(将一个流程的多个行为的状态累计在一个表中)</p><p>事实表应该包含以下信息：</p><ul><li>包含维度信息：维度越多描述行为越详细</li><li>包含度量值：所有行为必须可以用来统计，用来统计的值就是度量值</li></ul><p>设计事务事实表时一般可遵循以下四个步骤：<br>选择业务过程→声明粒度→确认维度→确认事实</p><p>dim表的数据来源：从业务数据库中确定主维表和相关维表，在从ods中找到该表</p><p>dwd表的数据来源：mysql不可以得到行为数据，只能得到状态数据，所以从maxwell中获取update,insert,delete操作的数据,就是行为数据(找到会应为行为变化的表)</p><p>首日获取的数据无法判断行为，所有，认为当前数据都是新增</p><p>建表-》load数据-》save数据</p><p>为什么dim大多是全量表dwd大多是增量表？<br>因为dim是状态数据，dwd是行为数据，状态数据需要全量，行为数据需要增量。</p><p>ADS<br>ads的数据是最终统计结果，所有不需要列存储，也不需要压缩snappy。<br>因为要同步到mysql，所有用行存储同步更快，文件格式tsv,压缩gzip。</p><p>因为要给客户看所有数据不会很多<br>所有ADS没有分区<br>ADS是客户要什么就建什么表</p><ul><li>统计周期：统计的时间范围</li><li>统计粒度：分析数据的角度(用那个维度分析)</li><li>指标：客户想要的结果数值<br>数据装载<br>-指标分析：</li><li>原子指标：业务过程(行为) + 度量值(要聚合的值) + 聚合逻辑(聚合函数)</li><li>派生指标：原子指标 + 统计周期(分区字段过滤，过滤的是文件夹) + 统计粒度(从哪个维度分析) + 业务限定(数据字段过滤，过滤的是文件)</li><li>衍生指标：通过多个派生指标计算得到的指标，如：比率、增长率、占比等</li></ul><p>dws层：<br>依赖于ads层<br>简化计算提前聚合，如果表可以在多个地方使用，可以提高效率<br>数据量大，要分区</p><p>1d数据来源：DIM,DWD<br>nd数据来源：必须为1d表<br>td数据来源：可以为1d表也可以为DIM表DWD表</p><p>表的设计：<br>参考ADS设计指标分析</p><ul><li>原子指标：行为 + 度量值 + 聚合逻辑</li><li>派生指标：原子指标 + 统计周期 + 统计粒度 + 业务限定</li><li>衍生指标：通过多个派生指标计算得到的指标，如：比率、增长率、占比等</li></ul><p>如果</p><ul><li>业务过程相同：数据来源相同</li><li>统计周期相同：数据分区相同</li><li>统计粒度相同：维度相同<br>这样的多个指标可以放在同一张表中，减少表的数量，提高查询效率。</li></ul><div class="video-container">[up主专用，视频内嵌代码贴在这]</div><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 建模<p>date: 1737874753000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Datax</title>
      <link href="/wenzhang/Datax/"/>
      <url>/wenzhang/Datax/</url>
      
        <content type="html"><![CDATA[<h2 id="1-DataX概述"><a href="#1-DataX概述" class="headerlink" title="1.DataX概述"></a>1.DataX概述</h2><p>DataX是阿里巴巴开源的一个异构数据源离线同步工具，致力于实现包括关系型数据库（Mysql、Oracle等）、HDFS、Hive、ODPS、HBase、FTP等各种异构数据源之间稳定高效的数据同步功能。</p><h2 id="2-DataX作用"><a href="#2-DataX作用" class="headerlink" title="2.DataX作用"></a>2.DataX作用</h2><p><img src="https://img01.zzh36111.us.kg/20250124141748.png" alt="DataX作为中间传输载体负责连接数据各种数据源"></p><h2 id="3-DataX支持的数据源"><a href="#3-DataX支持的数据源" class="headerlink" title="3.DataX支持的数据源"></a>3.DataX支持的数据源</h2><p>DataX目前已经有了比较全面的插件体系，主流的RDBMS数据库、NoSQL、大数据计算系统都已经接入，支持如下：</p><table><thead><tr><th>类型</th><th>数据源</th><th>Reader（读）</th><th>Writer（写）</th></tr></thead><tbody><tr><td>RDBMS 关系型数据库</td><td>MySQL</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Oracle</td><td>✔</td><td>✔</td></tr><tr><td></td><td>OceanBase</td><td>✔</td><td>✔</td></tr><tr><td></td><td>SQLServer</td><td>✔</td><td>✔</td></tr><tr><td></td><td>PostgreSQL</td><td>✔</td><td>✔</td></tr><tr><td></td><td>DRDS</td><td>✔</td><td>✔</td></tr><tr><td></td><td>通用 RDBMS</td><td>✔</td><td>✔</td></tr><tr><td>阿里云数仓数据库</td><td>ODPS</td><td>✔</td><td>✔</td></tr><tr><td></td><td>ADS</td><td>✔</td><td>✔</td></tr><tr><td></td><td>OSS</td><td>✔</td><td>✔</td></tr><tr><td></td><td>OCS</td><td>✔</td><td>✔</td></tr><tr><td>NoSQL 数据存储</td><td>OTS</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Hbase0.94</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Hbase1.1</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Phoenix4.x</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Phoenix5.x</td><td>✔</td><td>✔</td></tr><tr><td></td><td>MongoDB</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Hive</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Cassandra</td><td>✔</td><td>✔</td></tr><tr><td>无结构化数据存储</td><td>TxtFile</td><td>✔</td><td>✔</td></tr><tr><td></td><td>FTP</td><td>✔</td><td>✔</td></tr><tr><td></td><td>HDFS</td><td>✔</td><td>✔</td></tr><tr><td></td><td>Elasticsearch</td><td>✔</td><td>✔</td></tr><tr><td>时间序列数据库</td><td>OpenTSDB</td><td>✔</td><td></td></tr><tr><td></td><td>TSDB</td><td>✔</td><td>✔</td></tr></tbody></table><h2 id="3-DataX使用"><a href="#3-DataX使用" class="headerlink" title="3.DataX使用"></a>3.DataX使用</h2><p>DataX的使用非常简单，用户仅需要根据自己同步数据的数据源和目的地的类型来选择相应的Reader和Writer插件即可，并将Reader和Writer插件的信息配置在一个json文件中，然后，在执行命令时，指定配置文件提交数据同步任务即可。</p><h3 id="3-1DataX配置文件格式"><a href="#3-1DataX配置文件格式" class="headerlink" title="3.1DataX配置文件格式"></a>3.1DataX配置文件格式</h3><p>这里以同步HDFS数据到MySQL为例，说明DataX的配置文件格式。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;setting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;reader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hdfsreader&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/base_province&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;defaultFS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hdfs://hadoop102:8020&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fileType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gzip&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;encoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;nullFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\\N&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fieldDelimiter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\t&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;writer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysqlwriter&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;writeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;replace&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;region_id&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;area_code&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;iso_code&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;iso_3166_2&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;connection&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;jdbcUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jdbc:mysql://hadoop102:3306/gmall?useUnicode=true&amp;characterEncoding=utf-8&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                  <span class="string">&quot;test_province&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Reader和Writer的具体参数可参考<a href="https://github.com/alibaba/DataX/blob/master/README.md">官方文档</a></p><h3 id="3-2DataX命令执行"><a href="#3-2DataX命令执行" class="headerlink" title="3.2DataX命令执行"></a>3.2DataX命令执行</h3><p>DataX的命令执行非常简单，只需要在命令行中执行如下命令：  </p><blockquote><p>python bin&#x2F;datax.py job&#x2F;base_province.json</p></blockquote><h5 id="3-2-1DataX传参"><a href="#3-2-1DataX传参" class="headerlink" title="3.2.1DataX传参"></a>3.2.1DataX传参</h5><p>在生产环境中，离线数据同步任务需要每日定时重复执行，故HDFS上的目标路径通常会包含一层日期，用来对每日同步的数据加以分区，也就是说每日同步数据的目标路径不是固定的，因此DataX配置文件中的DHFSWriter插件中参数path的值应该是动态变化的。为实现这个业务需求，我们需要使用DataX的传参功能<br><strong>DataX传参用法</strong><br>① 首选在任务的json配置文件中使用${param}引用参数<br>② 然后在提交任务时使用-p “-Dparam&#x3D;value” 传入参数值</p><h2 id="4-DataX调优"><a href="#4-DataX调优" class="headerlink" title="4.DataX调优"></a>4.DataX调优</h2><h3 id="4-1DataX运行流程"><a href="#4-1DataX运行流程" class="headerlink" title="4.1DataX运行流程"></a>4.1DataX运行流程</h3><p><img src="https://img01.zzh36111.us.kg/20250124214146.png"></p><h3 id="4-2DataX调度决策思路"><a href="#4-2DataX调度决策思路" class="headerlink" title="4.2DataX调度决策思路"></a>4.2DataX调度决策思路</h3><p>举例来说，用户提交了一个DataX作业，并且配置了总的并发度为20，目的是对一个有100张分表的mysql数据源进行同步。DataX的调度决策思路是：</p><ol><li>DataX Job根据分库分表切分策略(默认一个表一个Task，可以根据业务需要在reader插件中进行切分策略调整)，将同步工作分成100个Task。</li><li>DataX根据配置的总的并发度20，以及每个Task Group的并发度5，DataX计算共需要分配4个TaskGroup。</li><li>4个TaskGroup平分100个Task，每一个TaskGroup负责运行25个Task。</li></ol><h3 id="4-3DataX调优建议"><a href="#4-3DataX调优建议" class="headerlink" title="4.3DataX调优建议"></a>4.3DataX调优建议</h3><ol><li>速度控制:DataX中提供了包括通道（并发）、记录流、字节流三种流控模式，可以根据需要控制你的作业速度，让你的作业在数据库可以承受的范围内达到最佳的同步速度。</li><li>优化参数</li></ol><table><thead><tr><th>参数</th><th>说明</th><th>注意事项</th></tr></thead><tbody><tr><td><code>job.setting.speed.channel</code></td><td>并发数</td><td></td></tr><tr><td><code>job.setting.speed.record</code></td><td>总 record 限速</td><td>配置此参数，则必须配置单个 channel 的 record 限速参数</td></tr><tr><td><code>job.setting.speed.byte</code></td><td>总 byte 限速</td><td>配置此参数，则必须配置单个 channel 的 byte 限速参数</td></tr><tr><td><code>core.transport.channel.speed.record</code></td><td>单个 channel 的 record 限速，默认 10000 条&#x2F;s</td><td></td></tr><tr><td><code>core.transport.channel.speed.byte</code></td><td>单个 channel 的 byte 限速，默认 1M&#x2F;s</td><td></td></tr></tbody></table><p>注意：如果配置了总record限速和总byte限速，channel并发数就会失效。因为配置了这两个参数后，实际的channel并发数是通过计算得到的<br>①计算公式：<br>并发数&#x3D;min(byte_总⁄〖byte〗_单个channel ，  record_总⁄〖record〗_单个channel )<br>② 配置实例：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;core&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;transport&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;byte&quot;</span><span class="punctuation">:</span> <span class="number">1048576</span> <span class="comment">//单个channel byte限速1M/s</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;setting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;byte&quot;</span> <span class="punctuation">:</span> <span class="number">5242880</span> <span class="comment">//总byte限速5M/s</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><!-- <div class="video-container">[up主专用，视频内嵌代码贴在这]</div> --><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: Datax<p>date: 1737698997000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>如何使用Maxwell进行全量表或增量表的数据同步</title>
      <link href="/wenzhang/Maxwell/"/>
      <url>/wenzhang/Maxwell/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Maxwell概述"><a href="#1-Maxwell概述" class="headerlink" title="1.Maxwell概述:"></a>1.Maxwell概述:</h2><p>Maxwell是使用Java编写(可以使用jps查看进程)的MySQL变更数据抓取软件。他会实时监控Mysql数据库的数据变更操作（包括insert、update、delete），并将变更数据以JSON的格式发送给Kafka、Kinesi等流数据处理平台。</p><h2 id="Maxwell输出数据格式"><a href="#Maxwell输出数据格式" class="headerlink" title="Maxwell输出数据格式"></a>Maxwell输出数据格式</h2><table><thead><tr><th>操作</th><th>SQL语句</th><th>数据格式</th></tr></thead><tbody><tr><td>插入</td><td><code>insert into gmall.student values(1, &#39;zhangsan&#39;);</code></td><td>&#96;&#96;&#96;json</td></tr><tr><td></td><td></td><td>{</td></tr><tr><td></td><td></td><td>“database”: “gmall”,</td></tr><tr><td></td><td></td><td>“table”: “student”,</td></tr><tr><td></td><td></td><td>“type”: “insert”,</td></tr><tr><td></td><td></td><td>“ts”: 1634004537,</td></tr><tr><td></td><td></td><td>“xid”: 1530907,</td></tr><tr><td></td><td></td><td>“commit”: true,</td></tr><tr><td></td><td></td><td>“data”: {</td></tr><tr><td></td><td></td><td>“id”: 1,</td></tr><tr><td></td><td></td><td>“name”: “zhangsan”</td></tr><tr><td></td><td></td><td>}</td></tr><tr><td></td><td></td><td>}</td></tr><tr><td></td><td></td><td>&#96;&#96;&#96;</td></tr><tr><td>更新</td><td><code>update gmall.student set name = &#39;lisi&#39; where id=1;</code></td><td>&#96;&#96;&#96;json</td></tr><tr><td></td><td></td><td>{</td></tr><tr><td></td><td></td><td>“database”: “gmall”,</td></tr><tr><td></td><td></td><td>“table”: “student”,</td></tr><tr><td></td><td></td><td>“type”: “update”,</td></tr><tr><td></td><td></td><td>“ts”: 1634004657,</td></tr><tr><td></td><td></td><td>“xid”: 1531916,</td></tr><tr><td></td><td></td><td>“commit”: true,</td></tr><tr><td></td><td></td><td>“data”: {</td></tr><tr><td></td><td></td><td>“id”: 1,</td></tr><tr><td></td><td></td><td>“name”: “lisi”</td></tr><tr><td></td><td></td><td>},</td></tr><tr><td></td><td></td><td>“old”: {</td></tr><tr><td></td><td></td><td>“name”: “zhangsan”</td></tr><tr><td></td><td></td><td>}</td></tr><tr><td></td><td></td><td>}</td></tr><tr><td></td><td></td><td>&#96;&#96;&#96;</td></tr><tr><td>删除</td><td><code>delete from gmall.student where id=1;</code></td><td>&#96;&#96;&#96;json</td></tr><tr><td></td><td></td><td>{</td></tr><tr><td></td><td></td><td>“database”: “gmall”,</td></tr><tr><td></td><td></td><td>“table”: “student”,</td></tr><tr><td></td><td></td><td>“type”: “delete”,</td></tr><tr><td></td><td></td><td>“ts”: 1634004751,</td></tr><tr><td></td><td></td><td>“xid”: 1532725,</td></tr><tr><td></td><td></td><td>“commit”: true,</td></tr><tr><td></td><td></td><td>“data”: {</td></tr><tr><td></td><td></td><td>“id”: 1,</td></tr><tr><td></td><td></td><td>“name”: “lisi”</td></tr><tr><td></td><td></td><td>}</td></tr><tr><td></td><td></td><td>}</td></tr><tr><td></td><td></td><td>&#96;&#96;&#96;</td></tr></tbody></table><p><strong>字段说明：</strong></p><ol><li><code>database</code>：变更数据所属的数据库</li><li><code>commit</code>：事务提交标志，可用于重新组装事务。 </li><li>xid：事务ID，用于标识事务。 </li><li>ts：变更数据的时间戳。 </li><li>type：变更数据的类型，包括insert、update、delete。 </li><li>data：变更数据，包括新增或修改的数据。 </li><li>old：变更前的数据，仅在update操作时存在。</li></ol><h2 id="2-Maxwell的实现原理"><a href="#2-Maxwell的实现原理" class="headerlink" title="2.Maxwell的实现原理"></a>2.Maxwell的实现原理</h2><p>Maxwell的实现原理很简单，就是将自己伪装成Slave，并遵循Mysql主从复制的协议，从master中同步数据。<br><strong>Mysql主从复制工作原理</strong><img src="https://img01.zzh36111.us.kg/20250123182703.png"><br>① Master主库接收到数据变更请求，完成数据变更，并将其写到二级制日志（binary log）中。<br>② Slave从库向Mysql master发送dump协议，将Master主库的binary log events拷贝到从库的中继日志（relay log）中。<br>③ Slave从库读取并回放中继日志中的事件，将更新的数据同步到自己的数据库中。</p><h2 id="3-Maxwell部署"><a href="#3-Maxwell部署" class="headerlink" title="3.Maxwell部署"></a>3.Maxwell部署</h2><h3 id="1-配置MySQL"><a href="#1-配置MySQL" class="headerlink" title="1.配置MySQL"></a>1.配置MySQL</h3><h4 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h4><p>配置MySQL启动MySQL Binlog（修改MySQL的配置文件&#x2F;etc&#x2F;my.cnf重启Mysql服务后才生效）</p><h4 id="2-1"><a href="#2-1" class="headerlink" title="2.1"></a>2.1</h4><p>Mysql Binlog模式介绍<br>① Statement-based: 基于语句，Binlog会记录所有写操作的SQL语句，包括：insert、update、delete等。<br>                    优点：节省空间；<br>                    缺点：有可能造成数据不一致，如：insert语句中包含now()函数。<br>② Row-based：       基于行，Binlog会记录每次写操作的被操作行记录的变化。<br>                    优点：保持数据的绝对一致性<br>                    缺点：占用较大空间<br>③ mixed：   混合模式，默认是Statement-based，如果SQL语句可能导致数据不一致，就自动切换到Row-based<br>Maxwell要求Binlog采用Row-based模式</p><h3 id="2-创建Maxwell所需数据库和用户"><a href="#2-创建Maxwell所需数据库和用户" class="headerlink" title="2.创建Maxwell所需数据库和用户"></a>2.创建Maxwell所需数据库和用户</h3><h3 id="3-配置Maxwell"><a href="#3-配置Maxwell" class="headerlink" title="3.配置Maxwell"></a>3.配置Maxwell</h3><h4 id="3-1"><a href="#3-1" class="headerlink" title="3.1"></a>3.1</h4><p>修改Maxwell的配置文件config.properties,主要是配置数据发送的目的地。（若Maxwell发送数据的目的地是kafka集群，需要首先将kafka集群启动。）</p><h2 id="4-启动Maxwell"><a href="#4-启动Maxwell" class="headerlink" title="4.启动Maxwell"></a>4.启动Maxwell</h2><p>Maxwell的启动命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/maxwell --config config.properties --daemon</span><br></pre></td></tr></table></figure><p>Maxwell关闭命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep maxwell | grep -v grep | grep maxwell | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9</span><br></pre></td></tr></table></figure><h3 id="Maxwell全量数据同步流程命令"><a href="#Maxwell全量数据同步流程命令" class="headerlink" title="Maxwell全量数据同步流程命令"></a>Maxwell全量数据同步流程命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/maxwell-bootstrap --database edu --table user_info --config config.properties</span><br></pre></td></tr></table></figure><!-- <div class="video-container">[up主专用，视频内嵌代码贴在这]</div> --><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 如何使用Maxwell进行全量表或增量表的数据同步<p>date: 1737624278000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>在线教育离线数仓之数据采集</title>
      <link href="/wenzhang/%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93%E4%B9%8B%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/"/>
      <url>/wenzhang/%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93%E4%B9%8B%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<!-- <div class="video-container">[up主专用，视频内嵌代码贴在这]</div> --><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style><!-- ---title: 在线教育离线数仓之数据采集<p>date: 1737542912000<br>tags:<br>— –&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/wenzhang/hello-world/"/>
      <url>/wenzhang/hello-world/</url>
      
        <content type="html"><![CDATA[<h1 id="博客预览"><a href="#博客预览" class="headerlink" title="博客预览"></a>博客预览</h1><blockquote><p>hexo cl; hexo s</p></blockquote><h1 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h1><blockquote><p>hexo cl; hexo g; hexo d</p></blockquote><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><h2 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><p><strong>引用</strong></p><ol><li>hjjk </li><li>jkdsfjl</li></ol><ul><li>skolfakashjd </li><li>kdsfjfjljds<br>djlksgjdfjksldfjl</li></ul><ul><li>sakllflj</li></ul><ul><li>sakhaklfhk</li></ul><ol><li>lsalk</li></ol><table><thead><tr><th>表头 1</th><th>表头 2</th></tr></thead><tbody><tr><td>内容 1</td><td>内容 2</td></tr><tr><td>内容 3</td><td>内容 4</td></tr></tbody></table><div style="text-align: center;"><table><thead><tr><th align="right">kalfl</th><th align="center">ldskkfldg</th></tr></thead><tbody><tr><td align="right">lslfjkk</td><td align="center">kdjfglk</td></tr></tbody></table></div><div style="text-align: center;"><table><thead><tr><th>服务名称</th><th>子服务</th><th>hadoop102</th><th>hadoop103</th><th>hadoop104</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode</td><td>√</td><td></td><td></td></tr><tr><td>HDFS</td><td>DataNode</td><td>√</td><td>√</td><td>√</td></tr><tr><td>HDFS</td><td>SecondaryNameNode</td><td></td><td></td><td>√</td></tr><tr><td>Yarn</td><td>NodeManager</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Yarn</td><td>Resourcemanager</td><td></td><td>√</td><td></td></tr><tr><td>Zookeeper</td><td>Zookeeper Server</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Flume(采集日志)</td><td>Flume</td><td>√</td><td>√</td><td></td></tr><tr><td>Kafka</td><td>Kafka</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Flume（消费Kafka日志）</td><td>Flume</td><td></td><td></td><td>√</td></tr><tr><td>Flume（消费Kafka业务）</td><td>Flume</td><td></td><td></td><td>√</td></tr><tr><td>Hive</td><td>Hive</td><td>√</td><td></td><td></td></tr><tr><td>MySQL</td><td>MySQL</td><td>√</td><td></td><td></td></tr><tr><td>DataX</td><td>DataX</td><td>√</td><td></td><td></td></tr><tr><td>Maxwell</td><td>Maxwell</td><td>√</td><td></td><td></td></tr><tr><td>Spark</td><td></td><td>√</td><td>√</td><td>√</td></tr><tr><td>ClickHouse</td><td></td><td>√</td><td></td><td></td></tr><tr><td>DolphinScheduler</td><td>ApiApplicationServer</td><td>√</td><td></td><td></td></tr><tr><td>DolphinScheduler</td><td>AlertServer</td><td>√</td><td></td><td></td></tr><tr><td>DolphinScheduler</td><td>MasterServer</td><td>√</td><td></td><td></td></tr><tr><td>DolphinScheduler</td><td>WorkerServer</td><td>√</td><td>√</td><td>√</td></tr><tr><td>DolphinScheduler</td><td>LoggerServer</td><td>√</td><td>√</td><td>√</td></tr></tbody></table><p>格式化 alt+shift+f</p></div>`dfhjkgh`<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lhjsdfkhs</span><br><span class="line">jkhdsfkj</span><br></pre></td></tr></table></figure><p>alt+shift+f格式化表格</p><p><a href="https://cmliussss.com/p/HexoBlogNo2/">超链接</a>：<a href="https://cmliussss.com/p/HexoBlogNo2/">https://cmliussss.com/p/HexoBlogNo2/</a></p><p>请<a href="https://cmliussss.com/p/HexoBlogNo2/">点我</a></p><h1 id="服务部署情况"><a href="#服务部署情况" class="headerlink" title="服务部署情况"></a>服务部署情况</h1><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>在线教育离线数仓使用的脚本合集</title>
      <link href="/wenzhang/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91%E9%A1%B9%E7%9B%AE/"/>
      <url>/wenzhang/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="1-集群执行命令脚本："><a href="#1-集群执行命令脚本：" class="headerlink" title="1. 集群执行命令脚本："></a>1. 集群执行命令脚本：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"> </span><br><span class="line">for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">do</span><br><span class="line">    echo --------- $i ----------</span><br><span class="line">    ssh $i &quot;$*&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="2-集群同步脚本"><a href="#2-集群同步脚本" class="headerlink" title="2. 集群同步脚本"></a>2. 集群同步脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1. 判断参数个数</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">  echo Not Enough Arguement!</span><br><span class="line">  exit;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2. 遍历集群所有机器</span></span><br><span class="line">for host in hadoop102 hadoop103 hadoop104</span><br><span class="line">do</span><br><span class="line">  echo ====================  $host  ====================</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">3. 遍历所有目录，挨个发送</span></span><br><span class="line">  for file in $@</span><br><span class="line">  do</span><br><span class="line">    #4 判断文件是否存在</span><br><span class="line">    if [ -e $file ]</span><br><span class="line">    then</span><br><span class="line">      #5. 获取父目录(dirname获取绝对路径父目录,相对路径获取的是.）</span><br><span class="line">      pdir=$(cd -P $(dirname $file); pwd)</span><br><span class="line">      #6. 获取当前文件的名称</span><br><span class="line">      fname=$(basename $file)</span><br><span class="line">      ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">      rsync -av $pdir/$fname $host:$pdir #-av是打印进度的</span><br><span class="line">    else</span><br><span class="line">      echo $file does not exists!</span><br><span class="line">    fi</span><br><span class="line">  done</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="3-Hadoop启动脚本"><a href="#3-Hadoop启动脚本" class="headerlink" title="3. Hadoop启动脚本"></a>3. Hadoop启动脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">    echo &quot;No Args Input...&quot;</span><br><span class="line">    exit ;</span><br><span class="line">fi</span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)</span><br><span class="line">        echo &quot; =================== 启动 hadoop集群 ===================&quot;</span><br><span class="line"></span><br><span class="line">        echo &quot; --------------- 启动 hdfs ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/sbin/start-dfs.sh&quot;</span><br><span class="line">        echo &quot; --------------- 启动 yarn ---------------&quot;</span><br><span class="line">        ssh hadoop103 &quot;/opt/module/hadoop/sbin/start-yarn.sh&quot;</span><br><span class="line">        echo &quot; --------------- 启动 historyserver ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/bin/mapred --daemon start historyserver&quot;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)</span><br><span class="line">        echo &quot; =================== 关闭 hadoop集群 ===================&quot;</span><br><span class="line"></span><br><span class="line">        echo &quot; --------------- 关闭 historyserver ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/bin/mapred --daemon stop historyserver&quot;</span><br><span class="line">        echo &quot; --------------- 关闭 yarn ---------------&quot;</span><br><span class="line">        ssh hadoop103 &quot;/opt/module/hadoop/sbin/stop-yarn.sh&quot;</span><br><span class="line">        echo &quot; --------------- 关闭 hdfs ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/sbin/stop-dfs.sh&quot;</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">    echo &quot;Input Args Error...&quot;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h3 id="4-Zookeeper启动脚本"><a href="#4-Zookeeper启动脚本" class="headerlink" title="4. Zookeeper启动脚本"></a>4. Zookeeper启动脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">判断是否输入参数</span></span><br><span class="line">if [ $# -lt 1 ]; then</span><br><span class="line">  echo &quot;请输入参数&quot;</span><br><span class="line">  exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">        for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">        do</span><br><span class="line">        echo ---------- zookeeper $i 启动 ------------</span><br><span class="line">                ssh $i &quot;/opt/module/zookeeper/bin/zkServer.sh start&quot;</span><br><span class="line">        done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">        for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">        do</span><br><span class="line">        echo ---------- zookeeper $i 停止 ------------    </span><br><span class="line">                ssh $i &quot;/opt/module/zookeeper/bin/zkServer.sh stop&quot;</span><br><span class="line">        done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">        for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">        do</span><br><span class="line">        echo ---------- zookeeper $i 状态 ------------    </span><br><span class="line">                ssh $i &quot;/opt/module/zookeeper/bin/zkServer.sh status&quot;</span><br><span class="line">        done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h3 id="5-Kafka启动脚本"><a href="#5-Kafka启动脚本" class="headerlink" title="5. Kafka启动脚本"></a>5. Kafka启动脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">判断是否输入参数</span></span><br><span class="line">if [ $# -lt 1 ]; then</span><br><span class="line">  echo &quot;请输入参数&quot;</span><br><span class="line">  exit</span><br><span class="line">fi</span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">    for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">    do</span><br><span class="line">        echo &quot; --------启动 $i Kafka-------&quot;</span><br><span class="line">        ssh $i &quot;/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties&quot;</span><br><span class="line">    done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">    for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">    do</span><br><span class="line">        echo &quot; --------停止 $i Kafka-------&quot;</span><br><span class="line">        ssh $i &quot;/opt/module/kafka/bin/kafka-server-stop.sh &quot;</span><br><span class="line">    done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><p>maxwell启动脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">MAXWELL_HOME=/opt/module/maxwell</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">grep -v grep是为了过滤掉grep本身的进程</span></span><br><span class="line">result=$(ps -ef | grep Maxwell | grep -v grep)</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">start )</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">判断result是否为空</span></span><br><span class="line">    if [ -z &quot;$result&quot; ]; then</span><br><span class="line">        echo &quot;启动Maxwell&quot;</span><br><span class="line">        $MAXWELL_HOME/bin/maxwell --config $MAXWELL_HOME/config.properties --daemon</span><br><span class="line">    else</span><br><span class="line">         echo &quot;Maxwell正在运行&quot;</span><br><span class="line">    fi</span><br><span class="line">;;</span><br><span class="line">stop )</span><br><span class="line">    if [ -z &quot;$result&quot; ]; then</span><br><span class="line">        echo &quot;Maxwell未在运行&quot;</span><br><span class="line">    else</span><br><span class="line">echo &quot;停止Maxwell&quot;</span><br><span class="line">        ps -ef | grep Maxwell | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9</span><br><span class="line">    fi</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><!-- <div class="video-container">[up主专用，视频内嵌代码贴在这]</div> --><style>.video-container {    position: relative;    width: 100%;    padding-top: 56.25%; /* 16:9 aspect ratio (height/width = 9/16 * 100%) */}.video-container iframe {    position: absolute;    top: 0;    left: 0;    width: 100%;    height: 100%;}</style>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>大数据项目之在线教育离线数仓</title>
      <link href="/wenzhang/%E8%BF%99%E6%98%AF%E4%B8%80%E7%AF%87%E6%96%B0%E7%9A%84%E5%8D%9A%E6%96%87/"/>
      <url>/wenzhang/%E8%BF%99%E6%98%AF%E4%B8%80%E7%AF%87%E6%96%B0%E7%9A%84%E5%8D%9A%E6%96%87/</url>
      
        <content type="html"><![CDATA[<h1 id="大数据开发项目之在线教育离线数仓从零到一（学习项目）"><a href="#大数据开发项目之在线教育离线数仓从零到一（学习项目）" class="headerlink" title="大数据开发项目之在线教育离线数仓从零到一（学习项目）"></a>大数据开发项目之在线教育离线数仓从零到一（学习项目）</h1><p>本文详细介绍了大数据开发项目之在线教育离线数仓的开发过程，从零到一，包括项目背景、需求分析、设计思路、技术选型、开发环境搭建、数据采集、数仓搭建、</p><h2 id="项目整体流程"><a href="#项目整体流程" class="headerlink" title="项目整体流程"></a>项目整体流程</h2><p>该项目是一个在线教育大数据开发项目，旨在构建离线数仓，对在线教育业务数据进行分析处理，以支持企业决策。以下是项目的详细流程：</p><h3 id="1-业务流程与数据来源"><a href="#1-业务流程与数据来源" class="headerlink" title="1. 业务流程与数据来源"></a>1. 业务流程与数据来源</h3><ul><li><strong>业务流程</strong>：用户从在线教育网站首页开始浏览课程，可通过分类查询或全文检索寻找课程，找到后可添加到购物车、登录、结算，生成订单和支付数据，订单生成后会进行跟踪处理。</li><li><strong>数据来源</strong>：包括用户行为数据（通过前端埋点采集，存储在 HDFS 文件中）和业务数据（存储在 MySQL 中）。(因为本项目为学习项目，所以数据来源均为数据模拟器模拟的虚拟数据)</li></ul><h3 id="2-系统数据流程设计"><a href="#2-系统数据流程设计" class="headerlink" title="2. 系统数据流程设计"></a>2. 系统数据流程设计</h3><ul><li><strong>集群流程图</strong>：业务服务器与 App 业务交互，通过 Nginx 进行数据传输。日志数据经日志服务器采集，可采用 flume 采集方式，部分数据经消息缓存后存入 Kafka。业务数据通过 DataX 每日同步从 MySQL 数据库导入。数据在集群中经过 ODS、DWD、DWS 等层的处理，最终用于可视化。<br><img src="https://img01.zzh36111.us.kg/20250122151413.png" alt="流程图"><br>问：为什么不直接使用flume把数据采集到hdfs，要在之间加一个kafka呢？可以把Kafka换为flume聚合吗？</li><li><strong>集群特点</strong>：具备多数据源对接能力，可进行离线批量和在线实时处理，有统一的集群管理配置监控平台，并实现用户认证和权限管理，满足多租户需求。</li></ul><h3 id="3-技术选型"><a href="#3-技术选型" class="headerlink" title="3. 技术选型"></a>3. 技术选型</h3><ul><li><p><strong>Apache 框架版本</strong>：确定了 Hadoop、Flume、Kafka、Hive、Sqoop 等多种技术框架的具体版本，每个版本都有其特定的功能特点，以满足项目需求。</p><table><thead><tr><th>框架</th><th>版本</th></tr></thead><tbody><tr><td>Hadoop</td><td>3.1.3</td></tr><tr><td>Zookeeper</td><td>3.5.7</td></tr><tr><td>MySQL</td><td>5.7.16</td></tr><tr><td>Hive</td><td>3.1.2</td></tr><tr><td>Flume</td><td>1.9.0</td></tr><tr><td>Kafka</td><td>3.0.0</td></tr><tr><td>Spark</td><td>3.0.0</td></tr><tr><td>DataX</td><td>3.0.0</td></tr><tr><td>Superset</td><td>1.3.2</td></tr><tr><td>DolphinScheduler</td><td>2.0.3</td></tr><tr><td>Maxwell</td><td>1.29.2</td></tr></tbody></table></li><li><p><strong>服务器选型</strong>：因为本项目仅为学习项目所以服务器选型比较简单仅为三台虚拟机。</p></li></ul><h3 id="4-集群规模规划"><a href="#4-集群规模规划" class="headerlink" title="4. 集群规模规划"></a>4. 集群规模规划</h3><ul><li><p><strong>集群规划</strong>：详细规划了各服务器节点上部署的组件，如 DataNode、NodeManager、ResourceManager 等在不同服务器上的分布。</p><table><thead><tr><th>服务名称</th><th>子服务</th><th>hadoop102</th><th>hadoop103</th><th>hadoop104</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode</td><td>√</td><td></td><td></td></tr><tr><td>HDFS</td><td>DataNode</td><td>√</td><td>√</td><td>√</td></tr><tr><td>HDFS</td><td>SecondaryNameNode</td><td></td><td></td><td>√</td></tr><tr><td>Yarn</td><td>NodeManager</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Yarn</td><td>Resourcemanager</td><td></td><td>√</td><td></td></tr><tr><td>Zookeeper</td><td>Zookeeper Server</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Flume(采集日志)</td><td>Flume</td><td>√</td><td>√</td><td></td></tr><tr><td>Kafka</td><td>Kafka</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Flume（消费Kafka日志）</td><td>Flume</td><td></td><td></td><td>√</td></tr><tr><td>Flume（消费Kafka业务）</td><td>Flume</td><td></td><td></td><td>√</td></tr><tr><td>Hive</td><td>Hive</td><td>√</td><td></td><td></td></tr><tr><td>MySQL</td><td>MySQL</td><td>√</td><td></td><td></td></tr><tr><td>DataX</td><td>DataX</td><td>√</td><td></td><td></td></tr><tr><td>Maxwell</td><td>Maxwell</td><td>√</td><td></td><td></td></tr><tr><td>Spark</td><td></td><td>√</td><td>√</td><td>√</td></tr><tr><td>DolphinScheduler</td><td>ApiApplicationServer</td><td>√</td><td></td><td></td></tr><tr><td>DolphinScheduler</td><td>AlertServer</td><td>√</td><td></td><td></td></tr><tr><td>DolphinScheduler</td><td>MasterServer</td><td>√</td><td></td><td></td></tr><tr><td>DolphinScheduler</td><td>WorkerServer</td><td>√</td><td>√</td><td>√</td></tr><tr><td>DolphinScheduler</td><td>LoggerServer</td><td>√</td><td>√</td><td>√</td></tr></tbody></table></li></ul><h3 id="5-数据仓库学习重点"><a href="#5-数据仓库学习重点" class="headerlink" title="5. 数据仓库学习重点"></a>5. 数据仓库学习重点</h3><ol><li>建模（建表）</li><li>SQL及优化</li><li>任务调度器</li></ol><p>如果直接将MySQL作为数据仓库数据源</p><ol><li>MySQL为行存储，数仓为列存储</li><li>MySQL不是海量数据，数据仓库要求海量数据（因为数据量越大，分析结果越准确）</li><li>会降低MySQL的查询性能</li><li>所以数仓设计自己的数据源要求汇总数据</li><li>加hdfs(因为数仓采用hive)为解耦合，数据源和数仓分离，数据源只负责采集数据，数仓只负责分析数据</li><li></li></ol><!-- ### 5. 数据生成与分析指标 - **数据生成器使用**：通过上传相关配置文件（application.yml、path.json、logback.xml 等）到指定目录，并修改配置文件参数，可在虚拟机指定路径下生成日志数据并向业务数据库插入业务数据。可生成不同日期数据，且能灵活配置用户点击路径和日志生成路径。 - **分析指标**：涵盖流量主题（如各来源流量统计、路径分析、各来源下单统计）、用户主题（如用户变动统计、留存率、新增活跃统计等）、课程主题（如各分类课程交易统计、评价统计、试听留存统计等）、交易主题、考试主题、播放主题、完课主题等多方面的指标，每个指标都有明确的统计周期和粒度要求。 -->]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
